<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Numba-compiled functions"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.dev/api/portfolio/nb/ rel=canonical><link href=../logs/ rel=prev><link href=../orders/ rel=next><link rel=icon href=/assets/logo/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.2+insiders-4.42.0"><title>nb - vectorbt</title><link rel=stylesheet href=../../../assets/stylesheets/main.f2778614.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.46987102.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-4QLCS0J048"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-4QLCS0J048",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-4QLCS0J048",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta property=og:title content=nb><meta property=og:type content=website><meta content=https://vectorbt.dev/api/portfolio/nb/ property=og:url><meta property=og:image:url content=/assets/logo/social-512x512.png><meta property=og:image:type content=image/png><meta property=og:description content="Numba-compiled functions"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/assets/logo/favicon-16x16.png><link rel=manifest href=/assets/logo/site.webmanifest><link rel=mask-icon href=/assets/logo/safari-pinned-tab.svg color=#1e2029><link rel="shortcut icon" href=/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e2029><meta name=msapplication-config content=/assets/logo/browserconfig.xml><meta name=theme-color content=#1e2029></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#vectorbt.portfolio.nb class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> Get access to <a href=https://vectorbt.pro/ style="color: #ff6e42; text-decoration: underline;">vectorbt PRO</a> and join our quant army! </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=vectorbt class="md-header__button md-logo" aria-label=vectorbt data-md-component=logo> <img src=../../../assets/logo/logo-white.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> vectorbt </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> nb </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=../../../documentation/ class=md-tabs__link> Documentation </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=../../../terms/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=vectorbt class="md-nav__button md-logo" aria-label=vectorbt data-md-component=logo> <img src=../../../assets/logo/logo-white.svg alt=logo> </a> vectorbt </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> vectorbt </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../.. class="md-nav__link "> <span class=md-ellipsis> Getting started </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting-started/features/ class=md-nav__link> <span class=md-ellipsis> Features </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/usage/ class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/resources/ class=md-nav__link> <span class=md-ellipsis> Resources </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> API </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_settings/ class=md-nav__link> <span class=md-ellipsis> _settings </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__container"> <a href=../../base/ class="md-nav__link "> <span class=md-ellipsis> base </span> </a> <label class="md-nav__link " for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> base </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../base/accessors/ class=md-nav__link> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../base/array_wrapper/ class=md-nav__link> <span class=md-ellipsis> array_wrapper </span> </a> </li> <li class=md-nav__item> <a href=../../base/column_grouper/ class=md-nav__link> <span class=md-ellipsis> column_grouper </span> </a> </li> <li class=md-nav__item> <a href=../../base/combine_fns/ class=md-nav__link> <span class=md-ellipsis> combine_fns </span> </a> </li> <li class=md-nav__item> <a href=../../base/index_fns/ class=md-nav__link> <span class=md-ellipsis> index_fns </span> </a> </li> <li class=md-nav__item> <a href=../../base/indexing/ class=md-nav__link> <span class=md-ellipsis> indexing </span> </a> </li> <li class=md-nav__item> <a href=../../base/reshape_fns/ class=md-nav__link> <span class=md-ellipsis> reshape_fns </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <div class="md-nav__link md-nav__container"> <a href=../../data/ class="md-nav__link "> <span class=md-ellipsis> data </span> </a> <label class="md-nav__link " for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/base/ class=md-nav__link> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../data/custom/ class=md-nav__link> <span class=md-ellipsis> custom </span> </a> </li> <li class=md-nav__item> <a href=../../data/updater/ class=md-nav__link> <span class=md-ellipsis> updater </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__container"> <a href=../../generic/ class="md-nav__link "> <span class=md-ellipsis> generic </span> </a> <label class="md-nav__link " for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> generic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../generic/accessors/ class=md-nav__link> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../generic/decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../generic/drawdowns/ class=md-nav__link> <span class=md-ellipsis> drawdowns </span> </a> </li> <li class=md-nav__item> <a href=../../generic/enums/ class=md-nav__link> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../generic/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> <li class=md-nav__item> <a href=../../generic/plots_builder/ class=md-nav__link> <span class=md-ellipsis> plots_builder </span> </a> </li> <li class=md-nav__item> <a href=../../generic/plotting/ class=md-nav__link> <span class=md-ellipsis> plotting </span> </a> </li> <li class=md-nav__item> <a href=../../generic/ranges/ class=md-nav__link> <span class=md-ellipsis> ranges </span> </a> </li> <li class=md-nav__item> <a href=../../generic/splitters/ class=md-nav__link> <span class=md-ellipsis> splitters </span> </a> </li> <li class=md-nav__item> <a href=../../generic/stats_builder/ class=md-nav__link> <span class=md-ellipsis> stats_builder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <div class="md-nav__link md-nav__container"> <a href=../../indicators/ class="md-nav__link "> <span class=md-ellipsis> indicators </span> </a> <label class="md-nav__link " for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> indicators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../indicators/basic/ class=md-nav__link> <span class=md-ellipsis> basic </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/configs/ class=md-nav__link> <span class=md-ellipsis> configs </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/factory/ class=md-nav__link> <span class=md-ellipsis> factory </span> </a> </li> <li class=md-nav__item> <a href=../../indicators/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <div class="md-nav__link md-nav__container"> <a href=../../labels/ class="md-nav__link "> <span class=md-ellipsis> labels </span> </a> <label class="md-nav__link " for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> labels </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../labels/enums/ class=md-nav__link> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../labels/generators/ class=md-nav__link> <span class=md-ellipsis> generators </span> </a> </li> <li class=md-nav__item> <a href=../../labels/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <div class="md-nav__link md-nav__container"> <a href=../../messaging/ class="md-nav__link "> <span class=md-ellipsis> messaging </span> </a> <label class="md-nav__link " for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> messaging </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../messaging/telegram/ class=md-nav__link> <span class=md-ellipsis> telegram </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ohlcv_accessors/ class=md-nav__link> <span class=md-ellipsis> ohlcv_accessors </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> portfolio </span> </a> <label class="md-nav__link " for=__nav_3_10 id=__nav_3_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=true> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> portfolio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../base/ class=md-nav__link> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../enums/ class=md-nav__link> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../logs/ class=md-nav__link> <span class=md-ellipsis> logs </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> nb </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> nb </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.approx_order_value_nb class=md-nav__link> <span class=md-ellipsis> approx_order_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_flow_nb class=md-nav__link> <span class=md-ellipsis> asset_flow_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_returns_nb class=md-nav__link> <span class=md-ellipsis> asset_returns_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_value_grouped_nb class=md-nav__link> <span class=md-ellipsis> asset_value_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_value_nb class=md-nav__link> <span class=md-ellipsis> asset_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.assets_nb class=md-nav__link> <span class=md-ellipsis> assets_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.benchmark_value_grouped_nb class=md-nav__link> <span class=md-ellipsis> benchmark_value_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.benchmark_value_nb class=md-nav__link> <span class=md-ellipsis> benchmark_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.build_call_seq class=md-nav__link> <span class=md-ellipsis> build_call_seq() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.build_call_seq_nb class=md-nav__link> <span class=md-ellipsis> build_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.buy_nb class=md-nav__link> <span class=md-ellipsis> buy_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_flow_grouped_nb class=md-nav__link> <span class=md-ellipsis> cash_flow_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_flow_nb class=md-nav__link> <span class=md-ellipsis> cash_flow_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_grouped_nb class=md-nav__link> <span class=md-ellipsis> cash_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> cash_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_nb class=md-nav__link> <span class=md-ellipsis> cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.check_group_init_cash_nb class=md-nav__link> <span class=md-ellipsis> check_group_init_cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.check_group_lens_nb class=md-nav__link> <span class=md-ellipsis> check_group_lens_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.close_position_nb class=md-nav__link> <span class=md-ellipsis> close_position_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.copy_trade_record_nb class=md-nav__link> <span class=md-ellipsis> copy_trade_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.dir_enex_signal_func_nb class=md-nav__link> <span class=md-ellipsis> dir_enex_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.execute_order_nb class=md-nav__link> <span class=md-ellipsis> execute_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_entry_trades_in_position_nb class=md-nav__link> <span class=md-ellipsis> fill_entry_trades_in_position_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_log_record_nb class=md-nav__link> <span class=md-ellipsis> fill_log_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_order_record_nb class=md-nav__link> <span class=md-ellipsis> fill_order_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_position_record_nb class=md-nav__link> <span class=md-ellipsis> fill_position_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_trade_record_nb class=md-nav__link> <span class=md-ellipsis> fill_trade_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.final_value_nb class=md-nav__link> <span class=md-ellipsis> final_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.flex_simulate_nb class=md-nav__link> <span class=md-ellipsis> flex_simulate_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.flex_simulate_row_wise_nb class=md-nav__link> <span class=md-ellipsis> flex_simulate_row_wise_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.generate_stop_signal_nb class=md-nav__link> <span class=md-ellipsis> generate_stop_signal_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_col_elem_nb class=md-nav__link> <span class=md-ellipsis> get_col_elem_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_elem_nb class=md-nav__link> <span class=md-ellipsis> get_elem_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_entry_trades_nb class=md-nav__link> <span class=md-ellipsis> get_entry_trades_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_exit_trades_nb class=md-nav__link> <span class=md-ellipsis> get_exit_trades_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_free_cash_diff_nb class=md-nav__link> <span class=md-ellipsis> get_free_cash_diff_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_group_value_ctx_nb class=md-nav__link> <span class=md-ellipsis> get_group_value_ctx_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_group_value_nb class=md-nav__link> <span class=md-ellipsis> get_group_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_long_size_nb class=md-nav__link> <span class=md-ellipsis> get_long_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_positions_nb class=md-nav__link> <span class=md-ellipsis> get_positions_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_short_size_nb class=md-nav__link> <span class=md-ellipsis> get_short_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_stop_price_nb class=md-nav__link> <span class=md-ellipsis> get_stop_price_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_trade_stats_nb class=md-nav__link> <span class=md-ellipsis> get_trade_stats_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.gross_exposure_nb class=md-nav__link> <span class=md-ellipsis> gross_exposure_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.group_mean_reduce_nb class=md-nav__link> <span class=md-ellipsis> group_mean_reduce_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.i_group_any_reduce_nb class=md-nav__link> <span class=md-ellipsis> i_group_any_reduce_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_cash_grouped_nb class=md-nav__link> <span class=md-ellipsis> init_cash_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_cash_nb class=md-nav__link> <span class=md-ellipsis> init_cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_records_nb class=md-nav__link> <span class=md-ellipsis> init_records_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.is_grouped_nb class=md-nav__link> <span class=md-ellipsis> is_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.ls_enex_signal_func_nb class=md-nav__link> <span class=md-ellipsis> ls_enex_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_adjust_sl_func_nb class=md-nav__link> <span class=md-ellipsis> no_adjust_sl_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_adjust_tp_func_nb class=md-nav__link> <span class=md-ellipsis> no_adjust_tp_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_flex_order_func_nb class=md-nav__link> <span class=md-ellipsis> no_flex_order_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_order_func_nb class=md-nav__link> <span class=md-ellipsis> no_order_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_post_func_nb class=md-nav__link> <span class=md-ellipsis> no_post_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_pre_func_nb class=md-nav__link> <span class=md-ellipsis> no_pre_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_signal_func_nb class=md-nav__link> <span class=md-ellipsis> no_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_nb class=md-nav__link> <span class=md-ellipsis> order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_not_filled_nb class=md-nav__link> <span class=md-ellipsis> order_not_filled_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_nothing_nb class=md-nav__link> <span class=md-ellipsis> order_nothing_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.position_coverage_grouped_nb class=md-nav__link> <span class=md-ellipsis> position_coverage_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.position_mask_grouped_nb class=md-nav__link> <span class=md-ellipsis> position_mask_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.process_order_nb class=md-nav__link> <span class=md-ellipsis> process_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.raise_rejected_order_nb class=md-nav__link> <span class=md-ellipsis> raise_rejected_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.replace_inf_price_nb class=md-nav__link> <span class=md-ellipsis> replace_inf_price_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.require_call_seq class=md-nav__link> <span class=md-ellipsis> require_call_seq() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_dir_conflict_nb class=md-nav__link> <span class=md-ellipsis> resolve_dir_conflict_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_opposite_entry_nb class=md-nav__link> <span class=md-ellipsis> resolve_opposite_entry_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_signal_conflict_nb class=md-nav__link> <span class=md-ellipsis> resolve_signal_conflict_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_stop_price_and_slippage_nb class=md-nav__link> <span class=md-ellipsis> resolve_stop_price_and_slippage_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.returns_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> returns_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sell_nb class=md-nav__link> <span class=md-ellipsis> sell_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.should_update_stop_nb class=md-nav__link> <span class=md-ellipsis> should_update_stop_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.shuffle_call_seq_nb class=md-nav__link> <span class=md-ellipsis> shuffle_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.signals_to_size_nb class=md-nav__link> <span class=md-ellipsis> signals_to_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_from_orders_nb class=md-nav__link> <span class=md-ellipsis> simulate_from_orders_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_from_signal_func_nb class=md-nav__link> <span class=md-ellipsis> simulate_from_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_nb class=md-nav__link> <span class=md-ellipsis> simulate_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_row_wise_nb class=md-nav__link> <span class=md-ellipsis> simulate_row_wise_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sort_call_seq_nb class=md-nav__link> <span class=md-ellipsis> sort_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sort_call_seq_out_nb class=md-nav__link> <span class=md-ellipsis> sort_call_seq_out_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sum_grouped_nb class=md-nav__link> <span class=md-ellipsis> sum_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_benchmark_return_nb class=md-nav__link> <span class=md-ellipsis> total_benchmark_return_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_profit_grouped_nb class=md-nav__link> <span class=md-ellipsis> total_profit_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_profit_nb class=md-nav__link> <span class=md-ellipsis> total_profit_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_return_nb class=md-nav__link> <span class=md-ellipsis> total_return_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.trade_losing_streak_nb class=md-nav__link> <span class=md-ellipsis> trade_losing_streak_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.trade_winning_streak_nb class=md-nav__link> <span class=md-ellipsis> trade_winning_streak_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.try_order_nb class=md-nav__link> <span class=md-ellipsis> try_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_open_pos_stats_nb class=md-nav__link> <span class=md-ellipsis> update_open_pos_stats_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_pos_record_nb class=md-nav__link> <span class=md-ellipsis> update_pos_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_value_nb class=md-nav__link> <span class=md-ellipsis> update_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.value_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> value_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.value_nb class=md-nav__link> <span class=md-ellipsis> value_nb() </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../orders/ class=md-nav__link> <span class=md-ellipsis> orders </span> </a> </li> <li class=md-nav__item> <a href=../trades/ class=md-nav__link> <span class=md-ellipsis> trades </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../px_accessors/ class=md-nav__link> <span class=md-ellipsis> px_accessors </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_12> <div class="md-nav__link md-nav__container"> <a href=../../records/ class="md-nav__link "> <span class=md-ellipsis> records </span> </a> <label class="md-nav__link " for=__nav_3_12 id=__nav_3_12_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> records </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../records/base/ class=md-nav__link> <span class=md-ellipsis> base </span> </a> </li> <li class=md-nav__item> <a href=../../records/col_mapper/ class=md-nav__link> <span class=md-ellipsis> col_mapper </span> </a> </li> <li class=md-nav__item> <a href=../../records/decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../records/mapped_array/ class=md-nav__link> <span class=md-ellipsis> mapped_array </span> </a> </li> <li class=md-nav__item> <a href=../../records/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_13> <div class="md-nav__link md-nav__container"> <a href=../../returns/ class="md-nav__link "> <span class=md-ellipsis> returns </span> </a> <label class="md-nav__link " for=__nav_3_13 id=__nav_3_13_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_13_label aria-expanded=false> <label class=md-nav__title for=__nav_3_13> <span class="md-nav__icon md-icon"></span> returns </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../returns/accessors/ class=md-nav__link> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../returns/metrics/ class=md-nav__link> <span class=md-ellipsis> metrics </span> </a> </li> <li class=md-nav__item> <a href=../../returns/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> <li class=md-nav__item> <a href=../../returns/qs_adapter/ class=md-nav__link> <span class=md-ellipsis> qs_adapter </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../root_accessors/ class=md-nav__link> <span class=md-ellipsis> root_accessors </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_15> <div class="md-nav__link md-nav__container"> <a href=../../signals/ class="md-nav__link "> <span class=md-ellipsis> signals </span> </a> <label class="md-nav__link " for=__nav_3_15 id=__nav_3_15_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_15_label aria-expanded=false> <label class=md-nav__title for=__nav_3_15> <span class="md-nav__icon md-icon"></span> signals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../signals/accessors/ class=md-nav__link> <span class=md-ellipsis> accessors </span> </a> </li> <li class=md-nav__item> <a href=../../signals/enums/ class=md-nav__link> <span class=md-ellipsis> enums </span> </a> </li> <li class=md-nav__item> <a href=../../signals/factory/ class=md-nav__link> <span class=md-ellipsis> factory </span> </a> </li> <li class=md-nav__item> <a href=../../signals/generators/ class=md-nav__link> <span class=md-ellipsis> generators </span> </a> </li> <li class=md-nav__item> <a href=../../signals/nb/ class=md-nav__link> <span class=md-ellipsis> nb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_16> <div class="md-nav__link md-nav__container"> <a href=../../utils/ class="md-nav__link "> <span class=md-ellipsis> utils </span> </a> <label class="md-nav__link " for=__nav_3_16 id=__nav_3_16_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_16_label aria-expanded=false> <label class=md-nav__title for=__nav_3_16> <span class="md-nav__icon md-icon"></span> utils </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../utils/array_/ class=md-nav__link> <span class=md-ellipsis> array_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/attr_/ class=md-nav__link> <span class=md-ellipsis> attr_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/checks/ class=md-nav__link> <span class=md-ellipsis> checks </span> </a> </li> <li class=md-nav__item> <a href=../../utils/colors/ class=md-nav__link> <span class=md-ellipsis> colors </span> </a> </li> <li class=md-nav__item> <a href=../../utils/config/ class=md-nav__link> <span class=md-ellipsis> config </span> </a> </li> <li class=md-nav__item> <a href=../../utils/datetime_/ class=md-nav__link> <span class=md-ellipsis> datetime_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../utils/docs/ class=md-nav__link> <span class=md-ellipsis> docs </span> </a> </li> <li class=md-nav__item> <a href=../../utils/enum_/ class=md-nav__link> <span class=md-ellipsis> enum_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/figure/ class=md-nav__link> <span class=md-ellipsis> figure </span> </a> </li> <li class=md-nav__item> <a href=../../utils/image_/ class=md-nav__link> <span class=md-ellipsis> image_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/mapping/ class=md-nav__link> <span class=md-ellipsis> mapping </span> </a> </li> <li class=md-nav__item> <a href=../../utils/math_/ class=md-nav__link> <span class=md-ellipsis> math_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/module_/ class=md-nav__link> <span class=md-ellipsis> module_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/params/ class=md-nav__link> <span class=md-ellipsis> params </span> </a> </li> <li class=md-nav__item> <a href=../../utils/random_/ class=md-nav__link> <span class=md-ellipsis> random_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/requests_/ class=md-nav__link> <span class=md-ellipsis> requests_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/schedule_/ class=md-nav__link> <span class=md-ellipsis> schedule_ </span> </a> </li> <li class=md-nav__item> <a href=../../utils/tags/ class=md-nav__link> <span class=md-ellipsis> tags </span> </a> </li> <li class=md-nav__item> <a href=../../utils/template/ class=md-nav__link> <span class=md-ellipsis> template </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../../terms/ class="md-nav__link "> <span class=md-ellipsis> Terms </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Terms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../terms/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.approx_order_value_nb class=md-nav__link> <span class=md-ellipsis> approx_order_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_flow_nb class=md-nav__link> <span class=md-ellipsis> asset_flow_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_returns_nb class=md-nav__link> <span class=md-ellipsis> asset_returns_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_value_grouped_nb class=md-nav__link> <span class=md-ellipsis> asset_value_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.asset_value_nb class=md-nav__link> <span class=md-ellipsis> asset_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.assets_nb class=md-nav__link> <span class=md-ellipsis> assets_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.benchmark_value_grouped_nb class=md-nav__link> <span class=md-ellipsis> benchmark_value_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.benchmark_value_nb class=md-nav__link> <span class=md-ellipsis> benchmark_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.build_call_seq class=md-nav__link> <span class=md-ellipsis> build_call_seq() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.build_call_seq_nb class=md-nav__link> <span class=md-ellipsis> build_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.buy_nb class=md-nav__link> <span class=md-ellipsis> buy_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_flow_grouped_nb class=md-nav__link> <span class=md-ellipsis> cash_flow_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_flow_nb class=md-nav__link> <span class=md-ellipsis> cash_flow_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_grouped_nb class=md-nav__link> <span class=md-ellipsis> cash_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> cash_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.cash_nb class=md-nav__link> <span class=md-ellipsis> cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.check_group_init_cash_nb class=md-nav__link> <span class=md-ellipsis> check_group_init_cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.check_group_lens_nb class=md-nav__link> <span class=md-ellipsis> check_group_lens_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.close_position_nb class=md-nav__link> <span class=md-ellipsis> close_position_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.copy_trade_record_nb class=md-nav__link> <span class=md-ellipsis> copy_trade_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.dir_enex_signal_func_nb class=md-nav__link> <span class=md-ellipsis> dir_enex_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.execute_order_nb class=md-nav__link> <span class=md-ellipsis> execute_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_entry_trades_in_position_nb class=md-nav__link> <span class=md-ellipsis> fill_entry_trades_in_position_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_log_record_nb class=md-nav__link> <span class=md-ellipsis> fill_log_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_order_record_nb class=md-nav__link> <span class=md-ellipsis> fill_order_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_position_record_nb class=md-nav__link> <span class=md-ellipsis> fill_position_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.fill_trade_record_nb class=md-nav__link> <span class=md-ellipsis> fill_trade_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.final_value_nb class=md-nav__link> <span class=md-ellipsis> final_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.flex_simulate_nb class=md-nav__link> <span class=md-ellipsis> flex_simulate_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.flex_simulate_row_wise_nb class=md-nav__link> <span class=md-ellipsis> flex_simulate_row_wise_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.generate_stop_signal_nb class=md-nav__link> <span class=md-ellipsis> generate_stop_signal_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_col_elem_nb class=md-nav__link> <span class=md-ellipsis> get_col_elem_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_elem_nb class=md-nav__link> <span class=md-ellipsis> get_elem_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_entry_trades_nb class=md-nav__link> <span class=md-ellipsis> get_entry_trades_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_exit_trades_nb class=md-nav__link> <span class=md-ellipsis> get_exit_trades_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_free_cash_diff_nb class=md-nav__link> <span class=md-ellipsis> get_free_cash_diff_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_group_value_ctx_nb class=md-nav__link> <span class=md-ellipsis> get_group_value_ctx_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_group_value_nb class=md-nav__link> <span class=md-ellipsis> get_group_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_long_size_nb class=md-nav__link> <span class=md-ellipsis> get_long_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_positions_nb class=md-nav__link> <span class=md-ellipsis> get_positions_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_short_size_nb class=md-nav__link> <span class=md-ellipsis> get_short_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_stop_price_nb class=md-nav__link> <span class=md-ellipsis> get_stop_price_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.get_trade_stats_nb class=md-nav__link> <span class=md-ellipsis> get_trade_stats_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.gross_exposure_nb class=md-nav__link> <span class=md-ellipsis> gross_exposure_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.group_mean_reduce_nb class=md-nav__link> <span class=md-ellipsis> group_mean_reduce_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.i_group_any_reduce_nb class=md-nav__link> <span class=md-ellipsis> i_group_any_reduce_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_cash_grouped_nb class=md-nav__link> <span class=md-ellipsis> init_cash_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_cash_nb class=md-nav__link> <span class=md-ellipsis> init_cash_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.init_records_nb class=md-nav__link> <span class=md-ellipsis> init_records_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.is_grouped_nb class=md-nav__link> <span class=md-ellipsis> is_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.ls_enex_signal_func_nb class=md-nav__link> <span class=md-ellipsis> ls_enex_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_adjust_sl_func_nb class=md-nav__link> <span class=md-ellipsis> no_adjust_sl_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_adjust_tp_func_nb class=md-nav__link> <span class=md-ellipsis> no_adjust_tp_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_flex_order_func_nb class=md-nav__link> <span class=md-ellipsis> no_flex_order_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_order_func_nb class=md-nav__link> <span class=md-ellipsis> no_order_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_post_func_nb class=md-nav__link> <span class=md-ellipsis> no_post_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_pre_func_nb class=md-nav__link> <span class=md-ellipsis> no_pre_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.no_signal_func_nb class=md-nav__link> <span class=md-ellipsis> no_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_nb class=md-nav__link> <span class=md-ellipsis> order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_not_filled_nb class=md-nav__link> <span class=md-ellipsis> order_not_filled_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.order_nothing_nb class=md-nav__link> <span class=md-ellipsis> order_nothing_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.position_coverage_grouped_nb class=md-nav__link> <span class=md-ellipsis> position_coverage_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.position_mask_grouped_nb class=md-nav__link> <span class=md-ellipsis> position_mask_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.process_order_nb class=md-nav__link> <span class=md-ellipsis> process_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.raise_rejected_order_nb class=md-nav__link> <span class=md-ellipsis> raise_rejected_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.replace_inf_price_nb class=md-nav__link> <span class=md-ellipsis> replace_inf_price_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.require_call_seq class=md-nav__link> <span class=md-ellipsis> require_call_seq() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_dir_conflict_nb class=md-nav__link> <span class=md-ellipsis> resolve_dir_conflict_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_opposite_entry_nb class=md-nav__link> <span class=md-ellipsis> resolve_opposite_entry_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_signal_conflict_nb class=md-nav__link> <span class=md-ellipsis> resolve_signal_conflict_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.resolve_stop_price_and_slippage_nb class=md-nav__link> <span class=md-ellipsis> resolve_stop_price_and_slippage_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.returns_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> returns_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sell_nb class=md-nav__link> <span class=md-ellipsis> sell_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.should_update_stop_nb class=md-nav__link> <span class=md-ellipsis> should_update_stop_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.shuffle_call_seq_nb class=md-nav__link> <span class=md-ellipsis> shuffle_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.signals_to_size_nb class=md-nav__link> <span class=md-ellipsis> signals_to_size_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_from_orders_nb class=md-nav__link> <span class=md-ellipsis> simulate_from_orders_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_from_signal_func_nb class=md-nav__link> <span class=md-ellipsis> simulate_from_signal_func_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_nb class=md-nav__link> <span class=md-ellipsis> simulate_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.simulate_row_wise_nb class=md-nav__link> <span class=md-ellipsis> simulate_row_wise_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sort_call_seq_nb class=md-nav__link> <span class=md-ellipsis> sort_call_seq_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sort_call_seq_out_nb class=md-nav__link> <span class=md-ellipsis> sort_call_seq_out_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.sum_grouped_nb class=md-nav__link> <span class=md-ellipsis> sum_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_benchmark_return_nb class=md-nav__link> <span class=md-ellipsis> total_benchmark_return_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_profit_grouped_nb class=md-nav__link> <span class=md-ellipsis> total_profit_grouped_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_profit_nb class=md-nav__link> <span class=md-ellipsis> total_profit_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.total_return_nb class=md-nav__link> <span class=md-ellipsis> total_return_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.trade_losing_streak_nb class=md-nav__link> <span class=md-ellipsis> trade_losing_streak_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.trade_winning_streak_nb class=md-nav__link> <span class=md-ellipsis> trade_winning_streak_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.try_order_nb class=md-nav__link> <span class=md-ellipsis> try_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_open_pos_stats_nb class=md-nav__link> <span class=md-ellipsis> update_open_pos_stats_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_pos_record_nb class=md-nav__link> <span class=md-ellipsis> update_pos_record_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.update_value_nb class=md-nav__link> <span class=md-ellipsis> update_value_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.value_in_sim_order_nb class=md-nav__link> <span class=md-ellipsis> value_in_sim_order_nb() </span> </a> </li> <li class=md-nav__item> <a href=#vectorbt.portfolio.nb.value_nb class=md-nav__link> <span class=md-ellipsis> value_nb() </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=vectorbt.portfolio.nb>nb <span class=dobjtype>module</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb title="Permanent link">&para;</a></h1> <p>Numba-compiled functions.</p> <p>Provides an arsenal of Numba-compiled functions that are used for portfolio modeling, such as generating and filling orders. These only accept NumPy arrays and other Numba-compatible types.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>vectorbt treats matrices as first-class citizens and expects input arrays to be 2-dim, unless function has suffix <code>_1d</code> or is meant to be input to another function.</p> <p>All functions passed as argument should be Numba-compiled.</p> <p>Records should retain the order they were created in.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Accumulation of roundoff error possible. See <a href=https://en.wikipedia.org/wiki/Round-off_error#Accumulation_of_roundoff_error>here</a> for explanation.</p> <p>Rounding errors can cause trades and positions to not close properly:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%.50f</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=mf>0.1</span><span class=p>)</span>  <span class=c1># has positive error</span>
<span class=go>0.10000000000000000555111512312578270211815834045410</span>

<span class=gp>&gt;&gt;&gt; </span><span class=c1># many buy transactions with positive error -&gt; cannot close position</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>sum</span><span class=p>([</span><span class=mf>0.1</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)])</span> <span class=o>-</span> <span class=mi>100000</span>
<span class=go>1.3328826753422618e-06</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%.50f</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=mf>0.3</span><span class=p>)</span>  <span class=c1># has negative error</span>
<span class=go>0.29999999999999998889776975374843459576368331909180</span>

<span class=gp>&gt;&gt;&gt; </span><span class=c1># many sell transactions with negative error -&gt; cannot close position</span>
<span class=gp>&gt;&gt;&gt; </span><span class=mi>300000</span> <span class=o>-</span> <span class=nb>sum</span><span class=p>([</span><span class=mf>0.3</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)])</span>
<span class=go>5.657668225467205e-06</span>
</code></pre></div> <p>While vectorbt has implemented tolerance checks when comparing floats for equality, adding/subtracting small amounts large number of times may still introduce a noticable error that cannot be corrected post factum.</p> <p>To mitigate this issue, avoid repeating lots of micro-transactions of the same sign. For example, reduce by <code>np.inf</code> or <code>position_now</code> to close a long/short position.</p> <p>See <a href=/api/utils/math_/ title=vectorbt.utils.math_>vectorbt.utils.math_</a> for current tolerance values.</p> </div> <hr> <h2 id=vectorbt.portfolio.nb.approx_order_value_nb>approx_order_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L987-L1017 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.approx_order_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>approx_order_value_nb</span><span class=p>(</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>size_type</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>cash_now</span><span class=p>,</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>free_cash_now</span><span class=p>,</span>
    <span class=n>val_price_now</span><span class=p>,</span>
    <span class=n>value_now</span>
<span class=p>)</span>
</code></pre></div> <p>Approximate value of an order.</p> <hr> <h2 id=vectorbt.portfolio.nb.asset_flow_nb>asset_flow_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5963-L6005 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.asset_flow_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>asset_flow_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>col_map</span><span class=p>,</span>
    <span class=n>direction</span>
<span class=p>)</span>
</code></pre></div> <p>Get asset flow series per column.</p> <p>Returns the total transacted amount of assets at each time step.</p> <hr> <h2 id=vectorbt.portfolio.nb.asset_returns_nb>asset_returns_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6404-L6413 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.asset_returns_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>asset_returns_nb</span><span class=p>(</span>
    <span class=n>cash_flow</span><span class=p>,</span>
    <span class=n>asset_value</span>
<span class=p>)</span>
</code></pre></div> <p>Get asset return series per column/group.</p> <hr> <h2 id=vectorbt.portfolio.nb.asset_value_grouped_nb>asset_value_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6253-L6256 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.asset_value_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>asset_value_grouped_nb</span><span class=p>(</span>
    <span class=n>asset_value</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Get asset value series per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.asset_value_nb>asset_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6247-L6250 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.asset_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>asset_value_nb</span><span class=p>(</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>assets</span>
<span class=p>)</span>
</code></pre></div> <p>Get asset value series per column.</p> <hr> <h2 id=vectorbt.portfolio.nb.assets_nb>assets_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6008-L6020 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.assets_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>assets_nb</span><span class=p>(</span>
    <span class=n>asset_flow</span>
<span class=p>)</span>
</code></pre></div> <p>Get asset series per column.</p> <p>Returns the current position at each time step.</p> <hr> <h2 id=vectorbt.portfolio.nb.benchmark_value_grouped_nb>benchmark_value_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6422-L6436 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.benchmark_value_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>benchmark_value_grouped_nb</span><span class=p>(</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash_grouped</span>
<span class=p>)</span>
</code></pre></div> <p>Get market value per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.benchmark_value_nb>benchmark_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6416-L6419 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.benchmark_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>benchmark_value_nb</span><span class=p>(</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>init_cash</span>
<span class=p>)</span>
</code></pre></div> <p>Get market value per column.</p> <hr> <h2 id=vectorbt.portfolio.nb.build_call_seq>build_call_seq <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L915-L930 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.build_call_seq title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>build_call_seq</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>call_seq_type</span><span class=o>=</span><span class=mi>0</span>
<span class=p>)</span>
</code></pre></div> <p>Not compiled but faster version of <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.build_call_seq_nb title=vectorbt.portfolio.nb.build_call_seq_nb>build_call_seq_nb()</a>.</p> <hr> <h2 id=vectorbt.portfolio.nb.build_call_seq_nb>build_call_seq_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L890-L907 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.build_call_seq_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>build_call_seq_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>call_seq_type</span><span class=o>=</span><span class=mi>0</span>
<span class=p>)</span>
</code></pre></div> <p>Build a new call sequence array.</p> <hr> <h2 id=vectorbt.portfolio.nb.buy_nb>buy_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L76-L226 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.buy_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>buy_nb</span><span class=p>(</span>
    <span class=n>exec_state</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>price</span><span class=p>,</span>
    <span class=n>direction</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
    <span class=n>fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>slippage</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>min_size</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>nan</span><span class=p>,</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>percent</span><span class=o>=</span><span class=n>nan</span>
<span class=p>)</span>
</code></pre></div> <p>Buy or/and cover.</p> <hr> <h2 id=vectorbt.portfolio.nb.cash_flow_grouped_nb>cash_flow_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6154-L6157 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.cash_flow_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>cash_flow_grouped_nb</span><span class=p>(</span>
    <span class=n>cash_flow</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Get cash flow series per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.cash_flow_nb>cash_flow_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6090-L6137 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.cash_flow_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>cash_flow_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>col_map</span><span class=p>,</span>
    <span class=n>free</span>
<span class=p>)</span>
</code></pre></div> <p>Get (free) cash flow series per column.</p> <hr> <h2 id=vectorbt.portfolio.nb.cash_grouped_nb>cash_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6223-L6241 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.cash_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>cash_grouped_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>cash_flow_grouped</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash_grouped</span>
<span class=p>)</span>
</code></pre></div> <p>Get cash series per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.cash_in_sim_order_nb>cash_in_sim_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6200-L6220 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.cash_in_sim_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>cash_in_sim_order_nb</span><span class=p>(</span>
    <span class=n>cash_flow</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash_grouped</span><span class=p>,</span>
    <span class=n>call_seq</span>
<span class=p>)</span>
</code></pre></div> <p>Get cash series in simulation order.</p> <hr> <h2 id=vectorbt.portfolio.nb.cash_nb>cash_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6189-L6197 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.cash_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>cash_nb</span><span class=p>(</span>
    <span class=n>cash_flow</span><span class=p>,</span>
    <span class=n>init_cash</span>
<span class=p>)</span>
</code></pre></div> <p>Get cash series per column.</p> <hr> <h2 id=vectorbt.portfolio.nb.check_group_init_cash_nb>check_group_init_cash_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L859-L867 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.check_group_init_cash_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>check_group_init_cash_nb</span><span class=p>(</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>n_cols</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>cash_sharing</span>
<span class=p>)</span>
</code></pre></div> <p>Check <code>init_cash</code>.</p> <hr> <h2 id=vectorbt.portfolio.nb.check_group_lens_nb>check_group_lens_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L852-L856 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.check_group_lens_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>check_group_lens_nb</span><span class=p>(</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>n_cols</span>
<span class=p>)</span>
</code></pre></div> <p>Check <code>group_lens</code>.</p> <hr> <h2 id=vectorbt.portfolio.nb.close_position_nb>close_position_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L809-L840 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.close_position_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>close_position_nb</span><span class=p>(</span>
    <span class=n>price</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>slippage</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>min_size</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>nan</span><span class=p>,</span>
    <span class=n>reject_prob</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>raise_reject</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>log</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>
</code></pre></div> <p>Close the current position.</p> <hr> <h2 id=vectorbt.portfolio.nb.copy_trade_record_nb>copy_trade_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5837-L5853 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.copy_trade_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>copy_trade_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>trade_record</span>
<span class=p>)</span>
</code></pre></div> <p>Copy a trade record.</p> <hr> <h2 id=vectorbt.portfolio.nb.dir_enex_signal_func_nb>dir_enex_signal_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2359-L2372 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.dir_enex_signal_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>dir_enex_signal_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=n>entries</span><span class=p>,</span>
    <span class=n>exits</span><span class=p>,</span>
    <span class=n>direction</span>
<span class=p>)</span>
</code></pre></div> <p>Resolve direction-aware signals out of entries, exits, and direction.</p> <hr> <h2 id=vectorbt.portfolio.nb.execute_order_nb>execute_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L367-L535 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.execute_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>execute_order_nb</span><span class=p>(</span>
    <span class=n>state</span><span class=p>,</span>
    <span class=n>order</span>
<span class=p>)</span>
</code></pre></div> <p>Execute an order given the current state.</p> <p><strong>Args</strong></p> <dl> <dt><strong><code>state</code></strong> :&ensp;<code>ProcessOrderState</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.ProcessOrderState title=vectorbt.portfolio.enums.ProcessOrderState>ProcessOrderState</a>.</dd> <dt><strong><code>order</code></strong> :&ensp;<code>Order</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.Order title=vectorbt.portfolio.enums.Order>Order</a>.</dd> </dl> <p>Error is thrown if an input has value that is not expected. Order is ignored if its execution has no effect on current balance. Order is rejected if an input goes over a limit/restriction.</p> <hr> <h2 id=vectorbt.portfolio.nb.fill_entry_trades_in_position_nb>fill_entry_trades_in_position_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5219-L5283 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.fill_entry_trades_in_position_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>fill_entry_trades_in_position_nb</span><span class=p>(</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>col_map</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>first_c</span><span class=p>,</span>
    <span class=n>last_c</span><span class=p>,</span>
    <span class=n>first_entry_size</span><span class=p>,</span>
    <span class=n>first_entry_fees</span><span class=p>,</span>
    <span class=n>exit_idx</span><span class=p>,</span>
    <span class=n>exit_size_sum</span><span class=p>,</span>
    <span class=n>exit_gross_sum</span><span class=p>,</span>
    <span class=n>exit_fees_sum</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>status</span><span class=p>,</span>
    <span class=n>parent_id</span><span class=p>,</span>
    <span class=n>trade_records</span><span class=p>,</span>
    <span class=n>tidx</span>
<span class=p>)</span>
</code></pre></div> <p>Fill entry trades located within a single position.</p> <hr> <h2 id=vectorbt.portfolio.nb.fill_log_record_nb>fill_log_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L538-L598 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.fill_log_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>fill_log_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>record_id</span><span class=p>,</span>
    <span class=n>i</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>group</span><span class=p>,</span>
    <span class=n>cash</span><span class=p>,</span>
    <span class=n>position</span><span class=p>,</span>
    <span class=n>debt</span><span class=p>,</span>
    <span class=n>free_cash</span><span class=p>,</span>
    <span class=n>val_price</span><span class=p>,</span>
    <span class=n>value</span><span class=p>,</span>
    <span class=n>order</span><span class=p>,</span>
    <span class=n>new_cash</span><span class=p>,</span>
    <span class=n>new_position</span><span class=p>,</span>
    <span class=n>new_debt</span><span class=p>,</span>
    <span class=n>new_free_cash</span><span class=p>,</span>
    <span class=n>new_val_price</span><span class=p>,</span>
    <span class=n>new_value</span><span class=p>,</span>
    <span class=n>order_result</span><span class=p>,</span>
    <span class=n>order_id</span>
<span class=p>)</span>
</code></pre></div> <p>Fill a log record.</p> <hr> <h2 id=vectorbt.portfolio.nb.fill_order_record_nb>fill_order_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L601-L615 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.fill_order_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>fill_order_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>record_id</span><span class=p>,</span>
    <span class=n>i</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>order_result</span>
<span class=p>)</span>
</code></pre></div> <p>Fill an order record.</p> <hr> <h2 id=vectorbt.portfolio.nb.fill_position_record_nb>fill_position_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5797-L5834 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.fill_position_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>fill_position_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>id_</span><span class=p>,</span>
    <span class=n>trade_records</span>
<span class=p>)</span>
</code></pre></div> <p>Fill a position record by aggregating trade records.</p> <hr> <h2 id=vectorbt.portfolio.nb.fill_trade_record_nb>fill_trade_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5177-L5216 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.fill_trade_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>fill_trade_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>id_</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>entry_idx</span><span class=p>,</span>
    <span class=n>entry_price</span><span class=p>,</span>
    <span class=n>entry_fees</span><span class=p>,</span>
    <span class=n>exit_idx</span><span class=p>,</span>
    <span class=n>exit_price</span><span class=p>,</span>
    <span class=n>exit_fees</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>status</span><span class=p>,</span>
    <span class=n>parent_id</span>
<span class=p>)</span>
</code></pre></div> <p>Fill a trade record.</p> <hr> <h2 id=vectorbt.portfolio.nb.final_value_nb>final_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6368-L6371 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.final_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>final_value_nb</span><span class=p>(</span>
    <span class=n>total_profit</span><span class=p>,</span>
    <span class=n>init_cash</span>
<span class=p>)</span>
</code></pre></div> <p>Get total profit per column/group.</p> <hr> <h2 id=vectorbt.portfolio.nb.flex_simulate_nb>flex_simulate_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L3929-L4622 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.flex_simulate_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>flex_simulate_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>cash_sharing</span><span class=p>,</span>
    <span class=n>segment_mask</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>call_pre_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>call_post_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_group_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_group_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_group_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_group_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>flex_order_func_nb</span><span class=o>=</span><span class=n>no_flex_order_func_nb</span><span class=p>,</span>
    <span class=n>flex_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>fill_pos_record</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Same as <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a>, but with no predefined call sequence.</p> <p>In contrast to <code>order_func_nb</code> in<a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a>, <code>post_order_func_nb</code> is a segment-level order function that returns a column along with the order, and gets repeatedly called until some condition is met. This allows multiple orders to be issued within a single element and in an arbitrary order.</p> <p>The order function should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.FlexOrderContext title=vectorbt.portfolio.enums.FlexOrderContext>FlexOrderContext</a>, unpacked tuple from <code>pre_segment_func_nb</code>, and <code>*flex_order_args</code>. Should return column and <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.Order title=vectorbt.portfolio.enums.Order>Order</a>. To break out of the loop, return column of -1.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Since one element can now accommodate multiple orders, you may run into "order_records index out of range" exception. In this case, you should increase <code>max_orders</code>. This cannot be done automatically and dynamically to avoid performance degradation.</p> </div> <p><strong>Usage</strong></p> <ul> <li>The same example as in <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a>:</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>numba</span> <span class=kn>import</span> <span class=n>njit</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.enums</span> <span class=kn>import</span> <span class=n>SizeType</span><span class=p>,</span> <span class=n>Direction</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=p>(</span>
<span class=gp>... </span>    <span class=n>get_col_elem_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_nothing_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>flex_simulate_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>flex_simulate_row_wise_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>sort_call_seq_out_nb</span>
<span class=gp>... </span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_sim_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;before simulation&#39;</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>()</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_group_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>before group&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>group</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Create temporary arrays and pass them down the stack</span>
<span class=gp>... </span>    <span class=n>order_value_out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>group_len</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float_</span><span class=p>)</span>
<span class=gp>... </span>    <span class=n>call_seq_out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>group_len</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int_</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Forward down the stack</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>order_value_out</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t</span><span class=s1>before segment&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_col</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_col</span><span class=p>):</span>
<span class=gp>... </span>        <span class=c1># Here we use order price for group valuation</span>
<span class=gp>... </span>        <span class=n>c</span><span class=o>.</span><span class=n>last_val_price</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>price</span><span class=p>)</span>
<span class=gp>...</span>
<span class=gp>... </span>    <span class=c1># Same as for simulate_nb, but since we don&#39;t have a predefined c.call_seq_now anymore,</span>
<span class=gp>... </span>    <span class=c1># we need to store our new call sequence somewhere else</span>
<span class=gp>... </span>    <span class=n>call_seq_out</span><span class=p>[:]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>group_len</span><span class=p>)</span>
<span class=gp>... </span>    <span class=n>sort_call_seq_out_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>)</span>
<span class=gp>...</span>
<span class=gp>... </span>    <span class=c1># Forward the sorted call sequence</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>call_seq_out</span><span class=p>,)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>flex_order_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>,</span> <span class=n>slippage</span><span class=p>):</span>
<span class=gp>... </span>    <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>call_idx</span> <span class=o>&lt;</span> <span class=n>c</span><span class=o>.</span><span class=n>group_len</span><span class=p>:</span>
<span class=gp>... </span>        <span class=n>col</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>from_col</span> <span class=o>+</span> <span class=n>call_seq_out</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>call_idx</span><span class=p>]</span>
<span class=gp>... </span>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t\t</span><span class=s1>creating order&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>call_idx</span><span class=p>,</span> <span class=s1>&#39;at column&#39;</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>
<span class=gp>... </span>        <span class=c1># # Create and return an order</span>
<span class=gp>... </span>        <span class=k>return</span> <span class=n>col</span><span class=p>,</span> <span class=n>order_nb</span><span class=p>(</span>
<span class=gp>... </span>            <span class=n>size</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>price</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>price</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>size_type</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>size_type</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>direction</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>direction</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>fees</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>fees</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>fixed_fees</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>),</span>
<span class=gp>... </span>            <span class=n>slippage</span><span class=o>=</span><span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>slippage</span><span class=p>)</span>
<span class=gp>... </span>        <span class=p>)</span>
<span class=gp>... </span>    <span class=c1># All columns already processed -&gt; break the loop</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t\t</span><span class=s1>breaking out of the loop&#39;</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>order_nothing_nb</span><span class=p>()</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_order_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t\t\t</span><span class=s1>order status:&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>order_result</span><span class=o>.</span><span class=n>status</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>,</span> <span class=n>call_seq_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t</span><span class=s1>after segment&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_group_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>after group&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>group</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_sim_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;after simulation&#39;</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>target_shape</span> <span class=o>=</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>group_lens</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>])</span>  <span class=c1># one group of three columns</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>init_cash</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>100.</span><span class=p>])</span>  <span class=c1># one capital per group</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>cash_sharing</span> <span class=o>=</span> <span class=kc>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>build_call_seq</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>group_lens</span><span class=p>)</span>  <span class=c1># will be overridden</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>segment_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>])[:,</span> <span class=kc>None</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>segment_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>segment_mask</span><span class=p>,</span> <span class=n>target_shape</span><span class=p>))</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>  <span class=c1># scalars must become 0-dim arrays</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>price</span> <span class=o>=</span> <span class=n>close</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>target_shape</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size_type</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>direction</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>Direction</span><span class=o>.</span><span class=n>LongOnly</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>fees</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>fixed_fees</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>1.</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>slippage</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>log_records</span> <span class=o>=</span> <span class=n>flex_simulate_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>cash_sharing</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>segment_mask</span><span class=o>=</span><span class=n>segment_mask</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>pre_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>post_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_group_func_nb</span><span class=o>=</span><span class=n>pre_group_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_group_func_nb</span><span class=o>=</span><span class=n>post_group_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>pre_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>post_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>flex_order_func_nb</span><span class=o>=</span><span class=n>flex_order_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>flex_order_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>,</span> <span class=n>slippage</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>post_order_func_nb</span>
<span class=gp>... </span><span class=p>)</span>
<span class=go>before simulation</span>
<span class=go>    before group 0</span>
<span class=go>        before segment 0</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            breaking out of the loop</span>
<span class=go>        after segment 0</span>
<span class=go>        before segment 2</span>
<span class=go>            creating order 0 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            breaking out of the loop</span>
<span class=go>        after segment 2</span>
<span class=go>        before segment 4</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            breaking out of the loop</span>
<span class=go>        after segment 4</span>
<span class=go>    after group 0</span>
<span class=go>after simulation</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.flex_simulate_row_wise_nb>flex_simulate_row_wise_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L4625-L5150 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.flex_simulate_row_wise_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>flex_simulate_row_wise_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>cash_sharing</span><span class=p>,</span>
    <span class=n>segment_mask</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>call_pre_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>call_post_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_row_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_row_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_row_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_row_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>flex_order_func_nb</span><span class=o>=</span><span class=n>no_flex_order_func_nb</span><span class=p>,</span>
    <span class=n>flex_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>fill_pos_record</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Same as <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.flex_simulate_nb title=vectorbt.portfolio.nb.flex_simulate_nb>flex_simulate_nb()</a>, but iterates using row-major order, with the rows changing fastest, and the columns/groups changing slowest.</p> <hr> <h2 id=vectorbt.portfolio.nb.generate_stop_signal_nb>generate_stop_signal_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1526-L1557 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.generate_stop_signal_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>generate_stop_signal_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>upon_stop_exit</span><span class=p>,</span>
    <span class=n>accumulate</span>
<span class=p>)</span>
</code></pre></div> <p>Generate stop signal and change accumulation if needed.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_col_elem_nb>get_col_elem_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L935-L939 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_col_elem_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_col_elem_nb</span><span class=p>(</span>
    <span class=n>ctx</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>a</span>
<span class=p>)</span>
</code></pre></div> <p>Get the current element using flexible indexing given the context and the column.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_elem_nb>get_elem_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L942-L946 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_elem_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_elem_nb</span><span class=p>(</span>
    <span class=n>ctx</span><span class=p>,</span>
    <span class=n>a</span>
<span class=p>)</span>
</code></pre></div> <p>Get the current element using flexible indexing given just the context.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_entry_trades_nb>get_entry_trades_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5286-L5518 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_entry_trades_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_entry_trades_nb</span><span class=p>(</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>col_map</span>
<span class=p>)</span>
</code></pre></div> <p>Fill entry trade records by aggregating order records.</p> <p>Entry trade records are buy orders in a long position and sell orders in a short position.</p> <p><strong>Usage</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>numba</span> <span class=kn>import</span> <span class=n>njit</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.records.nb</span> <span class=kn>import</span> <span class=n>col_map_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=n>simulate_from_orders_nb</span><span class=p>,</span> <span class=n>get_entry_trades_nb</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>order_price</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
<span class=gp>... </span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>([</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span>
<span class=gp>... </span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>target_shape</span> <span class=o>=</span> <span class=n>close</span><span class=o>.</span><span class=n>shape</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>group_lens</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>init_cash</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>100</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>log_records</span> <span class=o>=</span> <span class=n>simulate_from_orders_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.01</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>slippage</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>
<span class=gp>... </span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>entry_trade_records</span> <span class=o>=</span> <span class=n>get_entry_trades_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>,</span> <span class=n>close</span><span class=p>,</span> <span class=n>col_map</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>entry_trade_records</span><span class=p>)</span>
<span class=go>   id  col  size  entry_idx  entry_price  entry_fees  exit_idx  exit_price  \</span>
<span class=go>0   0    0   1.0          0         1.01     0.01010         3    3.060000</span>
<span class=go>1   1    0   0.1          1         2.02     0.00202         3    3.060000</span>
<span class=go>2   2    0   1.0          4         5.05     0.05050         5    5.940000</span>
<span class=go>3   3    0   1.0          5         5.94     0.05940         5    6.000000</span>
<span class=go>4   4    1   1.0          0         5.94     0.05940         3    3.948182</span>
<span class=go>5   5    1   0.1          1         4.95     0.00495         3    3.948182</span>
<span class=go>6   6    1   1.0          4         1.98     0.01980         5    1.010000</span>
<span class=go>7   7    1   1.0          5         1.01     0.01010         5    1.000000</span>

<span class=go>   exit_fees       pnl    return  direction  status  parent_id</span>
<span class=go>0   0.030600  2.009300  1.989406          0       1          0</span>
<span class=go>1   0.003060  0.098920  0.489703          0       1          0</span>
<span class=go>2   0.059400  0.780100  0.154475          0       1          1</span>
<span class=go>3   0.000000 -0.119400 -0.020101          1       0          2</span>
<span class=go>4   0.039482  1.892936  0.318676          1       1          3</span>
<span class=go>5   0.003948  0.091284  0.184411          1       1          3</span>
<span class=go>6   0.010100  0.940100  0.474798          1       1          4</span>
<span class=go>7   0.000000 -0.020100 -0.019901          0       0          5</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.get_exit_trades_nb>get_exit_trades_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5521-L5764 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_exit_trades_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_exit_trades_nb</span><span class=p>(</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>col_map</span>
<span class=p>)</span>
</code></pre></div> <p>Fill exit trade records by aggregating order records.</p> <p>Exit trade records are sell orders in a long position and buy orders in a short position.</p> <p><strong>Usage</strong></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>numba</span> <span class=kn>import</span> <span class=n>njit</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.records.nb</span> <span class=kn>import</span> <span class=n>col_map_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=n>simulate_from_orders_nb</span><span class=p>,</span> <span class=n>get_exit_trades_nb</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>order_price</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>6</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>6</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
<span class=gp>... </span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>([</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>... </span>    <span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span>
<span class=gp>... </span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>target_shape</span> <span class=o>=</span> <span class=n>close</span><span class=o>.</span><span class=n>shape</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>group_lens</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>init_cash</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>100</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>log_records</span> <span class=o>=</span> <span class=n>simulate_from_orders_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.01</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>slippage</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.01</span><span class=p>)</span>
<span class=gp>... </span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>exit_trade_records</span> <span class=o>=</span> <span class=n>get_exit_trades_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>,</span> <span class=n>close</span><span class=p>,</span> <span class=n>col_map</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>exit_trade_records</span><span class=p>)</span>
<span class=go>   id  col  size  entry_idx  entry_price  entry_fees  exit_idx  exit_price  \</span>
<span class=go>0   0    0   1.0          0     1.101818    0.011018         2        2.97</span>
<span class=go>1   1    0   0.1          0     1.101818    0.001102         3        3.96</span>
<span class=go>2   2    0   1.0          4     5.050000    0.050500         5        5.94</span>
<span class=go>3   3    0   1.0          5     5.940000    0.059400         5        6.00</span>
<span class=go>4   4    1   1.0          0     5.850000    0.058500         2        4.04</span>
<span class=go>5   5    1   0.1          0     5.850000    0.005850         3        3.03</span>
<span class=go>6   6    1   1.0          4     1.980000    0.019800         5        1.01</span>
<span class=go>7   7    1   1.0          5     1.010000    0.010100         5        1.00</span>

<span class=go>   exit_fees       pnl    return  direction  status  parent_id</span>
<span class=go>0    0.02970  1.827464  1.658589          0       1          0</span>
<span class=go>1    0.00396  0.280756  2.548119          0       1          0</span>
<span class=go>2    0.05940  0.780100  0.154475          0       1          1</span>
<span class=go>3    0.00000 -0.119400 -0.020101          1       0          2</span>
<span class=go>4    0.04040  1.711100  0.292496          1       1          3</span>
<span class=go>5    0.00303  0.273120  0.466872          1       1          3</span>
<span class=go>6    0.01010  0.940100  0.474798          1       1          4</span>
<span class=go>7    0.00000 -0.020100 -0.019901          0       0          5</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.get_free_cash_diff_nb>get_free_cash_diff_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6050-L6087 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_free_cash_diff_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_free_cash_diff_nb</span><span class=p>(</span>
    <span class=n>position_before</span><span class=p>,</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>debt_now</span><span class=p>,</span>
    <span class=n>price</span><span class=p>,</span>
    <span class=n>fees</span>
<span class=p>)</span>
</code></pre></div> <p>Get updated debt and free cash flow.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_group_value_ctx_nb>get_group_value_ctx_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L965-L984 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_group_value_ctx_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_group_value_ctx_nb</span><span class=p>(</span>
    <span class=n>seg_ctx</span>
<span class=p>)</span>
</code></pre></div> <p>Get group value from context.</p> <p>Accepts <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext title=vectorbt.portfolio.enums.SegmentContext>SegmentContext</a>.</p> <p>Best called once from <code>pre_segment_func_nb</code>. To set the valuation price, change <code>last_val_price</code> of the context in-place.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Cash sharing must be enabled.</p> </div> <hr> <h2 id=vectorbt.portfolio.nb.get_group_value_nb>get_group_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L949-L962 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_group_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_group_value_nb</span><span class=p>(</span>
    <span class=n>from_col</span><span class=p>,</span>
    <span class=n>to_col</span><span class=p>,</span>
    <span class=n>cash_now</span><span class=p>,</span>
    <span class=n>last_position</span><span class=p>,</span>
    <span class=n>last_val_price</span>
<span class=p>)</span>
</code></pre></div> <p>Get group value.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_long_size_nb>get_long_size_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5939-L5948 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_long_size_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_long_size_nb</span><span class=p>(</span>
    <span class=n>position_before</span><span class=p>,</span>
    <span class=n>position_now</span>
<span class=p>)</span>
</code></pre></div> <p>Get long size.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_positions_nb>get_positions_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5856-L5933 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_positions_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_positions_nb</span><span class=p>(</span>
    <span class=n>trade_records</span><span class=p>,</span>
    <span class=n>col_map</span>
<span class=p>)</span>
</code></pre></div> <p>Fill position records by aggregating trade records.</p> <p>Trades can be entry trades, exit trades, and even positions themselves - all will produce the same results.</p> <p><strong>Usage</strong></p> <ul> <li>Building upon the example in <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.get_exit_trades_nb title=vectorbt.portfolio.nb.get_exit_trades_nb>get_exit_trades_nb()</a>:</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=n>get_positions_nb</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>exit_trade_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>position_records</span> <span class=o>=</span> <span class=n>get_positions_nb</span><span class=p>(</span><span class=n>exit_trade_records</span><span class=p>,</span> <span class=n>col_map</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>position_records</span><span class=p>)</span>
<span class=go>   id  col  size  entry_idx  entry_price  entry_fees  exit_idx  exit_price  \</span>
<span class=go>0   0    0   1.1          0     1.101818     0.01212         3    3.060000</span>
<span class=go>1   1    0   1.0          4     5.050000     0.05050         5    5.940000</span>
<span class=go>2   2    0   1.0          5     5.940000     0.05940         5    6.000000</span>
<span class=go>3   3    1   1.1          0     5.850000     0.06435         3    3.948182</span>
<span class=go>4   4    1   1.0          4     1.980000     0.01980         5    1.010000</span>
<span class=go>5   5    1   1.0          5     1.010000     0.01010         5    1.000000</span>

<span class=go>   exit_fees      pnl    return  direction  status  parent_id</span>
<span class=go>0    0.03366  2.10822  1.739455          0       1          0</span>
<span class=go>1    0.05940  0.78010  0.154475          0       1          1</span>
<span class=go>2    0.00000 -0.11940 -0.020101          1       0          2</span>
<span class=go>3    0.04343  1.98422  0.308348          1       1          3</span>
<span class=go>4    0.01010  0.94010  0.474798          1       1          4</span>
<span class=go>5    0.00000 -0.02010 -0.019901          0       0          5</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.get_short_size_nb>get_short_size_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5951-L5960 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_short_size_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_short_size_nb</span><span class=p>(</span>
    <span class=n>position_before</span><span class=p>,</span>
    <span class=n>position_now</span>
<span class=p>)</span>
</code></pre></div> <p>Get short size.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_stop_price_nb>get_stop_price_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1796-L1823 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_stop_price_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_stop_price_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>stop_price</span><span class=p>,</span>
    <span class=n>stop</span><span class=p>,</span>
    <span class=nb>open</span><span class=p>,</span>
    <span class=n>low</span><span class=p>,</span>
    <span class=n>high</span><span class=p>,</span>
    <span class=n>hit_below</span>
<span class=p>)</span>
</code></pre></div> <p>Get stop price.</p> <p>If hit before open, returns open.</p> <hr> <h2 id=vectorbt.portfolio.nb.get_trade_stats_nb>get_trade_stats_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5159-L5174 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.get_trade_stats_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>get_trade_stats_nb</span><span class=p>(</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>entry_price</span><span class=p>,</span>
    <span class=n>entry_fees</span><span class=p>,</span>
    <span class=n>exit_price</span><span class=p>,</span>
    <span class=n>exit_fees</span><span class=p>,</span>
    <span class=n>direction</span>
<span class=p>)</span>
</code></pre></div> <p>Get trade statistics.</p> <hr> <h2 id=vectorbt.portfolio.nb.gross_exposure_nb>gross_exposure_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6448-L6459 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.gross_exposure_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>gross_exposure_nb</span><span class=p>(</span>
    <span class=n>asset_value</span><span class=p>,</span>
    <span class=n>cash</span>
<span class=p>)</span>
</code></pre></div> <p>Get gross exposure per column/group.</p> <hr> <h2 id=vectorbt.portfolio.nb.group_mean_reduce_nb>group_mean_reduce_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6035-L6038 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.group_mean_reduce_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>group_mean_reduce_nb</span><span class=p>(</span>
    <span class=n>group</span><span class=p>,</span>
    <span class=n>a</span>
<span class=p>)</span>
</code></pre></div> <p>Mean reducer for grouped columns.</p> <hr> <h2 id=vectorbt.portfolio.nb.i_group_any_reduce_nb>i_group_any_reduce_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6023-L6026 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.i_group_any_reduce_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>i_group_any_reduce_nb</span><span class=p>(</span>
    <span class=n>i</span><span class=p>,</span>
    <span class=n>group</span><span class=p>,</span>
    <span class=n>a</span>
<span class=p>)</span>
</code></pre></div> <p>Boolean "any" reducer for grouped columns.</p> <hr> <h2 id=vectorbt.portfolio.nb.init_cash_grouped_nb>init_cash_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6160-L6174 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.init_cash_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>init_cash_grouped_nb</span><span class=p>(</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>cash_sharing</span>
<span class=p>)</span>
</code></pre></div> <p>Get initial cash per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.init_cash_nb>init_cash_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6177-L6186 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.init_cash_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>init_cash_nb</span><span class=p>(</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>cash_sharing</span>
<span class=p>)</span>
</code></pre></div> <p>Get initial cash per column.</p> <hr> <h2 id=vectorbt.portfolio.nb.init_records_nb>init_records_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1166-L1179 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.init_records_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>init_records_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span>
<span class=p>)</span>
</code></pre></div> <p>Initialize order and log records.</p> <hr> <h2 id=vectorbt.portfolio.nb.is_grouped_nb>is_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L870-L873 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.is_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>is_grouped_nb</span><span class=p>(</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Check if columm,ns are grouped, that is, more than one column per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.ls_enex_signal_func_nb>ls_enex_signal_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2375-L2386 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.ls_enex_signal_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>ls_enex_signal_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=n>long_entries</span><span class=p>,</span>
    <span class=n>long_exits</span><span class=p>,</span>
    <span class=n>short_entries</span><span class=p>,</span>
    <span class=n>short_exits</span>
<span class=p>)</span>
</code></pre></div> <p>Get an element of direction-aware signals.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_adjust_sl_func_nb>no_adjust_sl_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1832-L1835 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_adjust_sl_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_adjust_sl_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder function that returns the initial stop-loss value and trailing flag.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_adjust_tp_func_nb>no_adjust_tp_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1838-L1841 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_adjust_tp_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_adjust_tp_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder function that returns the initial take-profit value.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_flex_order_func_nb>no_flex_order_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L3920-L3923 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_flex_order_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_flex_order_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder flexible order function that returns break column and no order.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_order_func_nb>no_order_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2395-L2398 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_order_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_order_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder order function that returns no order.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_post_func_nb>no_post_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2401-L2404 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_post_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_post_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder postprocessing function that returns nothing.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_pre_func_nb>no_pre_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2389-L2392 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_pre_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_pre_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder preprocessing function that forwards received arguments down the stack.</p> <hr> <h2 id=vectorbt.portfolio.nb.no_signal_func_nb>no_signal_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1826-L1829 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.no_signal_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>no_signal_func_nb</span><span class=p>(</span>
    <span class=n>c</span><span class=p>,</span>
    <span class=o>*</span><span class=n>args</span>
<span class=p>)</span>
</code></pre></div> <p>Placeholder signal function that returns no signal.</p> <hr> <h2 id=vectorbt.portfolio.nb.order_nb>order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L770-L806 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>order_nb</span><span class=p>(</span>
    <span class=n>size</span><span class=o>=</span><span class=n>nan</span><span class=p>,</span>
    <span class=n>price</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>size_type</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>direction</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
    <span class=n>fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>slippage</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>min_size</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>nan</span><span class=p>,</span>
    <span class=n>reject_prob</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>raise_reject</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>log</span><span class=o>=</span><span class=kc>False</span>
<span class=p>)</span>
</code></pre></div> <p>Create an order.</p> <p>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.Order title=vectorbt.portfolio.enums.Order>Order</a> for details on arguments.</p> <hr> <h2 id=vectorbt.portfolio.nb.order_not_filled_nb>order_not_filled_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L70-L73 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.order_not_filled_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>order_not_filled_nb</span><span class=p>(</span>
    <span class=n>status</span><span class=p>,</span>
    <span class=n>status_info</span>
<span class=p>)</span>
</code></pre></div> <p>Return <code>OrderResult</code> for order that hasn't been filled.</p> <hr> <h2 id=vectorbt.portfolio.nb.order_nothing_nb>order_nothing_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L843-L846 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.order_nothing_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>order_nothing_nb</span><span class=p>()</span>
</code></pre></div> <p>Convenience function to order nothing.</p> <hr> <h2 id=vectorbt.portfolio.nb.position_coverage_grouped_nb>position_coverage_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6041-L6044 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.position_coverage_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>position_coverage_grouped_nb</span><span class=p>(</span>
    <span class=n>position_mask</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Get coverage of position for each row and group.</p> <hr> <h2 id=vectorbt.portfolio.nb.position_mask_grouped_nb>position_mask_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6029-L6032 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.position_mask_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>position_mask_grouped_nb</span><span class=p>(</span>
    <span class=n>position_mask</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Get whether in position for each row and group.</p> <hr> <h2 id=vectorbt.portfolio.nb.process_order_nb>process_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L677-L767 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.process_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>process_order_nb</span><span class=p>(</span>
    <span class=n>i</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>group</span><span class=p>,</span>
    <span class=n>state</span><span class=p>,</span>
    <span class=n>update_value</span><span class=p>,</span>
    <span class=n>order</span><span class=p>,</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>log_records</span>
<span class=p>)</span>
</code></pre></div> <p>Process an order by executing it, saving relevant information to the logs, and returning a new state.</p> <hr> <h2 id=vectorbt.portfolio.nb.raise_rejected_order_nb>raise_rejected_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L618-L650 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.raise_rejected_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>raise_rejected_order_nb</span><span class=p>(</span>
    <span class=n>order_result</span>
<span class=p>)</span>
</code></pre></div> <p>Raise an <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.RejectedOrderError title=vectorbt.portfolio.enums.RejectedOrderError>RejectedOrderError</a>.</p> <hr> <h2 id=vectorbt.portfolio.nb.replace_inf_price_nb>replace_inf_price_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1116-L1140 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.replace_inf_price_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>replace_inf_price_nb</span><span class=p>(</span>
    <span class=n>prev_close</span><span class=p>,</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>order</span>
<span class=p>)</span>
</code></pre></div> <p>Replace infinity price in an order.</p> <hr> <h2 id=vectorbt.portfolio.nb.require_call_seq>require_call_seq <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L910-L912 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.require_call_seq title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>require_call_seq</span><span class=p>(</span>
    <span class=n>call_seq</span>
<span class=p>)</span>
</code></pre></div> <p>Force the call sequence array to pass our requirements.</p> <hr> <h2 id=vectorbt.portfolio.nb.resolve_dir_conflict_nb>resolve_dir_conflict_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1625-L1655 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.resolve_dir_conflict_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>resolve_dir_conflict_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>is_long_entry</span><span class=p>,</span>
    <span class=n>is_short_entry</span><span class=p>,</span>
    <span class=n>upon_dir_conflict</span>
<span class=p>)</span>
</code></pre></div> <p>Resolve any direction conflict between a long entry and a short entry.</p> <hr> <h2 id=vectorbt.portfolio.nb.resolve_opposite_entry_nb>resolve_opposite_entry_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1658-L1691 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.resolve_opposite_entry_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>resolve_opposite_entry_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>is_long_entry</span><span class=p>,</span>
    <span class=n>is_long_exit</span><span class=p>,</span>
    <span class=n>is_short_entry</span><span class=p>,</span>
    <span class=n>is_short_exit</span><span class=p>,</span>
    <span class=n>upon_opposite_entry</span><span class=p>,</span>
    <span class=n>accumulate</span>
<span class=p>)</span>
</code></pre></div> <p>Resolve opposite entry.</p> <hr> <h2 id=vectorbt.portfolio.nb.resolve_signal_conflict_nb>resolve_signal_conflict_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1576-L1622 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.resolve_signal_conflict_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>resolve_signal_conflict_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>is_entry</span><span class=p>,</span>
    <span class=n>is_exit</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>conflict_mode</span>
<span class=p>)</span>
</code></pre></div> <p>Resolve any conflict between an entry and an exit.</p> <hr> <h2 id=vectorbt.portfolio.nb.resolve_stop_price_and_slippage_nb>resolve_stop_price_and_slippage_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1560-L1573 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.resolve_stop_price_and_slippage_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>resolve_stop_price_and_slippage_nb</span><span class=p>(</span>
    <span class=n>stop_price</span><span class=p>,</span>
    <span class=n>price</span><span class=p>,</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>slippage</span><span class=p>,</span>
    <span class=n>stop_exit_price</span>
<span class=p>)</span>
</code></pre></div> <p>Resolve price and slippage of a stop order.</p> <hr> <h2 id=vectorbt.portfolio.nb.returns_in_sim_order_nb>returns_in_sim_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6380-L6401 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.returns_in_sim_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>returns_in_sim_order_nb</span><span class=p>(</span>
    <span class=n>value_iso</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash_grouped</span><span class=p>,</span>
    <span class=n>call_seq</span>
<span class=p>)</span>
</code></pre></div> <p>Get portfolio return series in simulation order.</p> <hr> <h2 id=vectorbt.portfolio.nb.sell_nb>sell_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L229-L364 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.sell_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>sell_nb</span><span class=p>(</span>
    <span class=n>exec_state</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>price</span><span class=p>,</span>
    <span class=n>direction</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
    <span class=n>fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>slippage</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>min_size</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>inf</span><span class=p>,</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>nan</span><span class=p>,</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>percent</span><span class=o>=</span><span class=n>nan</span>
<span class=p>)</span>
</code></pre></div> <p>Sell or/and short sell.</p> <hr> <h2 id=vectorbt.portfolio.nb.should_update_stop_nb>should_update_stop_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1787-L1793 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.should_update_stop_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>should_update_stop_nb</span><span class=p>(</span>
    <span class=n>stop</span><span class=p>,</span>
    <span class=n>upon_stop_update</span>
<span class=p>)</span>
</code></pre></div> <p>Whether to update stop.</p> <hr> <h2 id=vectorbt.portfolio.nb.shuffle_call_seq_nb>shuffle_call_seq_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L879-L887 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.shuffle_call_seq_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>shuffle_call_seq_nb</span><span class=p>(</span>
    <span class=n>call_seq</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Shuffle the call sequence array.</p> <hr> <h2 id=vectorbt.portfolio.nb.signals_to_size_nb>signals_to_size_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1694-L1784 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.signals_to_size_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>signals_to_size_nb</span><span class=p>(</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>is_long_entry</span><span class=p>,</span>
    <span class=n>is_long_exit</span><span class=p>,</span>
    <span class=n>is_short_entry</span><span class=p>,</span>
    <span class=n>is_short_exit</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>size_type</span><span class=p>,</span>
    <span class=n>accumulate</span><span class=p>,</span>
    <span class=n>val_price_now</span>
<span class=p>)</span>
</code></pre></div> <p>Translate direction-aware signals into size, size type, and direction.</p> <hr> <h2 id=vectorbt.portfolio.nb.simulate_from_orders_nb>simulate_from_orders_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1304-L1523 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.simulate_from_orders_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>simulate_from_orders_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>call_seq</span><span class=p>,</span>
    <span class=n>size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>size_type</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>direction</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
    <span class=n>fees</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>slippage</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>min_size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>reject_prob</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>raise_reject</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>log</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>val_price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>auto_call_seq</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Creates on order out of each element.</p> <p>Iterates in the column-major order. Utilizes flexible broadcasting.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Should be only grouped if cash sharing is enabled.</p> <p>If <code>auto_call_seq</code> is True, make sure that <code>call_seq</code> follows <code>CallSeqType.Default</code>.</p> <p>Single value should be passed as a 0-dim array (for example, by using <code>np.asarray(value)</code>).</p> </div> <p><strong>Usage</strong></p> <ul> <li>Buy and hold using all cash and closing price (default):</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.records.nb</span> <span class=kn>import</span> <span class=n>col_map_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=n>simulate_from_orders_nb</span><span class=p>,</span> <span class=n>asset_flow_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.enums</span> <span class=kn>import</span> <span class=n>Direction</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])[:,</span> <span class=kc>None</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>simulate_from_orders_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>100</span><span class=p>]),</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
<span class=gp>... </span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_flow</span> <span class=o>=</span> <span class=n>asset_flow_nb</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>order_records</span><span class=p>,</span> <span class=n>col_map</span><span class=p>,</span> <span class=n>Direction</span><span class=o>.</span><span class=n>Both</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_flow</span>
<span class=go>array([[100.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.]])</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.simulate_from_signal_func_nb>simulate_from_signal_func_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1849-L2356 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.simulate_from_signal_func_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>simulate_from_signal_func_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>call_seq</span><span class=p>,</span>
    <span class=n>signal_func_nb</span><span class=o>=</span><span class=n>no_signal_func_nb</span><span class=p>,</span>
    <span class=n>signal_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>size_type</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>fees</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>fixed_fees</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>slippage</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>min_size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>max_size</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=n>size_granularity</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>reject_prob</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mf>0.</span><span class=p>),</span>
    <span class=n>lock_cash</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>allow_partial</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>raise_reject</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>log</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>accumulate</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_long_conflict</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_short_conflict</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_dir_conflict</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_opposite_entry</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>4</span><span class=p>),</span>
    <span class=n>val_price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>inf</span><span class=p>),</span>
    <span class=nb>open</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>high</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>low</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>sl_stop</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>sl_trail</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span>
    <span class=n>tp_stop</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>stop_entry_price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span>
    <span class=n>stop_exit_price</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_stop_exit</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span>
    <span class=n>upon_stop_update</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
    <span class=n>adjust_sl_func_nb</span><span class=o>=</span><span class=n>no_adjust_sl_func_nb</span><span class=p>,</span>
    <span class=n>adjust_sl_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>adjust_tp_func_nb</span><span class=o>=</span><span class=n>no_adjust_tp_func_nb</span><span class=p>,</span>
    <span class=n>adjust_tp_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>use_stops</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>auto_call_seq</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Creates an order out of each element by resolving entry and exit signals returned by <code>signal_func_nb</code>.</p> <p>Iterates in the column-major order. Utilizes flexible broadcasting.</p> <p>Signals are processed using the following pipeline:</p> <p>1) If there is a stop signal, convert it to direction-aware signals and proceed to 7) 2) Get direction-aware signals using <code>signal_func_nb</code> 3) Resolve any entry and exit conflict of each direction using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.resolve_signal_conflict_nb title=vectorbt.portfolio.nb.resolve_signal_conflict_nb>resolve_signal_conflict_nb()</a> 4) Resolve any direction conflict using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.resolve_dir_conflict_nb title=vectorbt.portfolio.nb.resolve_dir_conflict_nb>resolve_dir_conflict_nb()</a> 5) Resolve an opposite entry signal scenario using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.resolve_opposite_entry_nb title=vectorbt.portfolio.nb.resolve_opposite_entry_nb>resolve_opposite_entry_nb()</a> 7) Convert the final signals into size, size type, and direction using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.signals_to_size_nb title=vectorbt.portfolio.nb.signals_to_size_nb>signals_to_size_nb()</a></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Should be only grouped if cash sharing is enabled.</p> <p>If <code>auto_call_seq</code> is True, make sure that <code>call_seq</code> follows <code>CallSeqType.Default</code>.</p> <p>Single value should be passed as a 0-dim array (for example, by using <code>np.asarray(value)</code>).</p> </div> <p><strong>Usage</strong></p> <ul> <li>Buy and hold using all cash and closing price (default):</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.records.nb</span> <span class=kn>import</span> <span class=n>col_map_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio</span> <span class=kn>import</span> <span class=n>nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.enums</span> <span class=kn>import</span> <span class=n>Direction</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])[:,</span> <span class=kc>None</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>nb</span><span class=o>.</span><span class=n>simulate_from_signal_func_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=o>=</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>]),</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>100</span><span class=p>]),</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>signal_func_nb</span><span class=o>=</span><span class=n>nb</span><span class=o>.</span><span class=n>dir_enex_signal_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>signal_args</span><span class=o>=</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=kc>False</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>Direction</span><span class=o>.</span><span class=n>LongOnly</span><span class=p>))</span>
<span class=gp>... </span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_flow</span> <span class=o>=</span> <span class=n>nb</span><span class=o>.</span><span class=n>asset_flow_nb</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span> <span class=n>order_records</span><span class=p>,</span> <span class=n>col_map</span><span class=p>,</span> <span class=n>Direction</span><span class=o>.</span><span class=n>Both</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_flow</span>
<span class=go>array([[100.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.],</span>
<span class=go>       [  0.]])</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.simulate_nb>simulate_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L2419-L3291 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.simulate_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>simulate_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>cash_sharing</span><span class=p>,</span>
    <span class=n>call_seq</span><span class=p>,</span>
    <span class=n>segment_mask</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>call_pre_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>call_post_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_group_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_group_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_group_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_group_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>order_func_nb</span><span class=o>=</span><span class=n>no_order_func_nb</span><span class=p>,</span>
    <span class=n>order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>fill_pos_record</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Fill order and log records by iterating over a shape and calling a range of user-defined functions.</p> <p>Starting with initial cash <code>init_cash</code>, iterates over each group and column in <code>target_shape</code>, and for each data point, generates an order using <code>order_func_nb</code>. Tries then to fulfill that order. Upon success, updates the current state including the cash balance and the position.</p> <p>Returns order records of layout <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.order_dt title=vectorbt.portfolio.enums.order_dt>order_dt</a> and log records of layout <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.log_dt title=vectorbt.portfolio.enums.log_dt>log_dt</a>.</p> <p>As opposed to <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_row_wise_nb title=vectorbt.portfolio.nb.simulate_row_wise_nb>simulate_row_wise_nb()</a>, order processing happens in column-major order. Column-major order means processing the entire column/group with all rows before moving to the next one. See <a href=https://en.wikipedia.org/wiki/Row-_and_column-major_order>Row- and column-major order</a>.</p> <p><strong>Args</strong></p> <dl> <dt><strong><code>target_shape</code></strong> :&ensp;<code>tuple</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.target_shape title=vectorbt.portfolio.enums.SimulationContext.target_shape>SimulationContext.target_shape</a>.</dd> <dt><strong><code>group_lens</code></strong> :&ensp;<code>array_like</code> of <code>int</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.group_lens title=vectorbt.portfolio.enums.SimulationContext.group_lens>SimulationContext.group_lens</a>.</dd> <dt><strong><code>init_cash</code></strong> :&ensp;<code>array_like</code> of <code>float</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.init_cash title=vectorbt.portfolio.enums.SimulationContext.init_cash>SimulationContext.init_cash</a>.</dd> <dt><strong><code>cash_sharing</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.cash_sharing title=vectorbt.portfolio.enums.SimulationContext.cash_sharing>SimulationContext.cash_sharing</a>.</dd> <dt><strong><code>call_seq</code></strong> :&ensp;<code>array_like</code> of <code>int</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.call_seq title=vectorbt.portfolio.enums.SimulationContext.call_seq>SimulationContext.call_seq</a>.</dd> <dt><strong><code>segment_mask</code></strong> :&ensp;<code>array_like</code> of <code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.segment_mask title=vectorbt.portfolio.enums.SimulationContext.segment_mask>SimulationContext.segment_mask</a>.</dd> <dt><strong><code>call_pre_segment</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.call_pre_segment title=vectorbt.portfolio.enums.SimulationContext.call_pre_segment>SimulationContext.call_pre_segment</a>.</dd> <dt><strong><code>call_post_segment</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.call_post_segment title=vectorbt.portfolio.enums.SimulationContext.call_post_segment>SimulationContext.call_post_segment</a>.</dd> <dt><strong><code>pre_sim_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called before simulation.</p> <p>Can be used for creation of global arrays and setting the seed.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext title=vectorbt.portfolio.enums.SimulationContext>SimulationContext</a> and <code>*pre_sim_args</code>. Should return a tuple of any content, which is then passed to <code>pre_group_func_nb</code> and <code>post_group_func_nb</code>.</p> </dd> <dt><strong><code>pre_sim_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>pre_sim_func_nb</code>.</dd> <dt><strong><code>post_sim_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called after simulation.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext title=vectorbt.portfolio.enums.SimulationContext>SimulationContext</a> and <code>*post_sim_args</code>. Should return nothing.</p> </dd> <dt><strong><code>post_sim_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>post_sim_func_nb</code>.</dd> <dt><strong><code>pre_group_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called before each group.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.GroupContext title=vectorbt.portfolio.enums.GroupContext>GroupContext</a>, unpacked tuple from <code>pre_sim_func_nb</code>, and <code>*pre_group_args</code>. Should return a tuple of any content, which is then passed to <code>pre_segment_func_nb</code> and <code>post_segment_func_nb</code>.</p> </dd> <dt><strong><code>pre_group_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>pre_group_func_nb</code>.</dd> <dt><strong><code>post_group_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called after each group.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.GroupContext title=vectorbt.portfolio.enums.GroupContext>GroupContext</a>, unpacked tuple from <code>pre_sim_func_nb</code>, and <code>*post_group_args</code>. Should return nothing.</p> </dd> <dt><strong><code>post_group_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>post_group_func_nb</code>.</dd> <dt><strong><code>pre_segment_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called before each segment.</p> <p>Called if <code>segment_mask</code> or <code>call_pre_segment</code> is True.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext title=vectorbt.portfolio.enums.SegmentContext>SegmentContext</a>, unpacked tuple from <code>pre_group_func_nb</code>, and <code>*pre_segment_args</code>. Should return a tuple of any content, which is then passed to <code>order_func_nb</code> and <code>post_order_func_nb</code>.</p> <p>This is the right place to change call sequence and set the valuation price. Group re-valuation and update of the open position stats happens right after this function, regardless of whether it has been called.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>To change the call sequence of a segment, access <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext.call_seq_now title=vectorbt.portfolio.enums.SegmentContext.call_seq_now>SegmentContext.call_seq_now</a> and change it in-place. Make sure to not generate any new arrays as it may negatively impact performance. Assigning <code>SegmentContext.call_seq_now</code> as any other context (named tuple) value is not supported. See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext.call_seq_now title=vectorbt.portfolio.enums.SegmentContext.call_seq_now>SegmentContext.call_seq_now</a>.</p> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You can override elements of <code>last_val_price</code> to manipulate group valuation. See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.last_val_price title=vectorbt.portfolio.enums.SimulationContext.last_val_price>SimulationContext.last_val_price</a>.</p> </div> </dd> <dt><strong><code>pre_segment_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>pre_segment_func_nb</code>.</dd> <dt><strong><code>post_segment_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Function called after each segment.</p> <p>Called if <code>segment_mask</code> or <code>call_post_segment</code> is True.</p> <p>The last group re-valuation and update of the open position stats happens right before this function, regardless of whether it has been called.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext title=vectorbt.portfolio.enums.SegmentContext>SegmentContext</a>, unpacked tuple from <code>pre_group_func_nb</code>, and <code>*post_segment_args</code>. Should return nothing.</p> </dd> <dt><strong><code>post_segment_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Packed arguments passed to <code>post_segment_func_nb</code>.</dd> <dt><strong><code>order_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Order generation function.</p> <p>Used for either generating an order or skipping.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.OrderContext title=vectorbt.portfolio.enums.OrderContext>OrderContext</a>, unpacked tuple from <code>pre_segment_func_nb</code>, and <code>*order_args</code>. Should return <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.Order title=vectorbt.portfolio.enums.Order>Order</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If the returned order has been rejected, there is no way of issuing a new order. You should make sure that the order passes, for example, by using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.try_order_nb title=vectorbt.portfolio.nb.try_order_nb>try_order_nb()</a>.</p> <p>To have a greater freedom in order management, use <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.flex_simulate_nb title=vectorbt.portfolio.nb.flex_simulate_nb>flex_simulate_nb()</a>.</p> </div> </dd> <dt><strong><code>order_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Arguments passed to <code>order_func_nb</code>.</dd> <dt><strong><code>post_order_func_nb</code></strong> :&ensp;<code>callable</code></dt> <dd> <p>Callback that is called after the order has been processed.</p> <p>Used for checking the order status and doing some post-processing.</p> <p>Should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.PostOrderContext title=vectorbt.portfolio.enums.PostOrderContext>PostOrderContext</a>, unpacked tuple from <code>pre_segment_func_nb</code>, and <code>*post_order_args</code>. Should return nothing.</p> </dd> <dt><strong><code>post_order_args</code></strong> :&ensp;<code>tuple</code></dt> <dd>Arguments passed to <code>post_order_func_nb</code>.</dd> <dt><strong><code>close</code></strong> :&ensp;<code>array_like</code> of <code>float</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.close title=vectorbt.portfolio.enums.SimulationContext.close>SimulationContext.close</a>.</dd> <dt><strong><code>ffill_val_price</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.ffill_val_price title=vectorbt.portfolio.enums.SimulationContext.ffill_val_price>SimulationContext.ffill_val_price</a>.</dd> <dt><strong><code>update_value</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.update_value title=vectorbt.portfolio.enums.SimulationContext.update_value>SimulationContext.update_value</a>.</dd> <dt><strong><code>fill_pos_record</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.fill_pos_record title=vectorbt.portfolio.enums.SimulationContext.fill_pos_record>SimulationContext.fill_pos_record</a>.</dd> <dt><strong><code>max_orders</code></strong> :&ensp;<code>int</code></dt> <dd>Size of the order records array.</dd> <dt><strong><code>max_logs</code></strong> :&ensp;<code>int</code></dt> <dd>Size of the log records array.</dd> <dt><strong><code>flex_2d</code></strong> :&ensp;<code>bool</code></dt> <dd>See <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SimulationContext.flex_2d title=vectorbt.portfolio.enums.SimulationContext.flex_2d>SimulationContext.flex_2d</a>.</dd> </dl> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Remember that indexing of 2-dim arrays in vectorbt follows that of pandas: <code>a[i, col]</code>.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>You can only safely access data of columns that are to the left of the current group and rows that are to the top of the current row within the same group. Other data points have not been processed yet and thus empty. Accessing them will not trigger any errors or warnings, but provide you with arbitrary data (see <a href=https://numpy.org/doc/stable/reference/generated/numpy.empty.html>np.empty</a>).</p> </div> <p><strong>Call hierarchy</strong></p> <p>Like most things in the vectorbt universe, simulation is also done by iterating over a (imaginary) frame. This frame consists of two dimensions: time (rows) and assets/features (columns). Each element of this frame is a potential order, which gets generated by calling an order function.</p> <p>The question is: how do we move across this frame to simulate trading? There are two movement patterns: column-major (as done by <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a>) and row-major order (as done by <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_row_wise_nb title=vectorbt.portfolio.nb.simulate_row_wise_nb>simulate_row_wise_nb()</a>). In each of these patterns, we are always moving from top to bottom (time axis) and from left to right (asset/feature axis); the only difference between them is across which axis we are moving faster: do we want to process each column first (thus assuming that columns are independent) or each row? Choosing between them is mostly a matter of preference, but it also makes different data being available when generating an order.</p> <p>The frame is further divided into "blocks": columns, groups, rows, segments, and elements. For example, columns can be grouped into groups that may or may not share the same capital. Regardless of capital sharing, each collection of elements within a group and a time step is called a segment, which simply defines a single context (such as shared capital) for one or multiple orders. Each segment can also define a custom sequence (a so-called call sequence) in which orders are executed.</p> <p>You can imagine each of these blocks as a rectangle drawn over different parts of the frame, and having its own context and pre/post-processing function. The pre-processing function is a simple callback that is called before entering the block, and can be provided by the user to, for example, prepare arrays or do some custom calculations. It must return a tuple (can be empty) that is then unpacked and passed as arguments to the pre- and postprocessing function coming next in the call hierarchy. The postprocessing function can be used, for example, to write user-defined arrays such as returns.</p> <p>Let's demonstrate a frame with one group of two columns and one group of one column, and the following call sequence:</p> <div class=highlight><pre><span></span><code>array([[0, 1, 0],
       [1, 0, 0]])
</code></pre></div> <p><img alt src=/assets/images/simulate_nb.gif></p> <p>And here is the context information available at each step:</p> <p><img alt src=/assets/images/context_info.png></p> <p><strong>Usage</strong></p> <ul> <li>Create a group of three assets together sharing 100$ and simulate an equal-weighted portfolio that rebalances every second tick, all without leaving Numba:</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>namedtuple</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>numba</span> <span class=kn>import</span> <span class=n>njit</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.generic.plotting</span> <span class=kn>import</span> <span class=n>Scatter</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.records.nb</span> <span class=kn>import</span> <span class=n>col_map_nb</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.enums</span> <span class=kn>import</span> <span class=n>SizeType</span><span class=p>,</span> <span class=n>Direction</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span> <span class=nn>vectorbt.portfolio.nb</span> <span class=kn>import</span> <span class=p>(</span>
<span class=gp>... </span>    <span class=n>get_col_elem_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>get_elem_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>simulate_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>simulate_row_wise_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>build_call_seq</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>sort_call_seq_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>asset_flow_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>assets_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>asset_value_nb</span>
<span class=gp>... </span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_sim_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;before simulation&#39;</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Create a temporary array and pass it down the stack</span>
<span class=gp>... </span>    <span class=n>order_value_out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float_</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>order_value_out</span><span class=p>,)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_group_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>before group&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>group</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Forward down the stack (you can omit pre_group_func_nb entirely)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>order_value_out</span><span class=p>,)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t</span><span class=s1>before segment&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_col</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_col</span><span class=p>):</span>
<span class=gp>... </span>        <span class=c1># Here we use order price for group valuation</span>
<span class=gp>... </span>        <span class=n>c</span><span class=o>.</span><span class=n>last_val_price</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>get_col_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>col</span><span class=p>,</span> <span class=n>price</span><span class=p>)</span>
<span class=gp>...</span>
<span class=gp>... </span>    <span class=c1># Reorder call sequence of this segment such that selling orders come first and buying last</span>
<span class=gp>... </span>    <span class=c1># Rearranges c.call_seq_now based on order value (size, size_type, direction, and val_price)</span>
<span class=gp>... </span>    <span class=c1># Utilizes flexible indexing using get_col_elem_nb (as we did above)</span>
<span class=gp>... </span>    <span class=n>sort_call_seq_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>from_col</span><span class=p>:</span><span class=n>c</span><span class=o>.</span><span class=n>to_col</span><span class=p>])</span>
<span class=gp>... </span>    <span class=c1># Forward nothing</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>()</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>order_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>,</span> <span class=n>slippage</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t\t</span><span class=s1>creating order&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>call_idx</span><span class=p>,</span> <span class=s1>&#39;at column&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Create and return an order</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=n>order_nb</span><span class=p>(</span>
<span class=gp>... </span>        <span class=n>size</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>price</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>price</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>size_type</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>size_type</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>direction</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>direction</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>fees</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fees</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>fixed_fees</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>),</span>
<span class=gp>... </span>        <span class=n>slippage</span><span class=o>=</span><span class=n>get_elem_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>slippage</span><span class=p>)</span>
<span class=gp>... </span>    <span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_order_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t\t\t</span><span class=s1>order status:&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>order_result</span><span class=o>.</span><span class=n>status</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t\t</span><span class=s1>after segment&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_group_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>after group&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>group</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_sim_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;after simulation&#39;</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>target_shape</span> <span class=o>=</span> <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>group_lens</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>])</span>  <span class=c1># one group of three columns</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>init_cash</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>100.</span><span class=p>])</span>  <span class=c1># one capital per group</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>cash_sharing</span> <span class=o>=</span> <span class=kc>True</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>build_call_seq</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>group_lens</span><span class=p>)</span>  <span class=c1># will be overridden</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>segment_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>])[:,</span> <span class=kc>None</span><span class=p>]</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>segment_mask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>segment_mask</span><span class=p>,</span> <span class=n>target_shape</span><span class=p>))</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>  <span class=c1># scalars must become 0-dim arrays</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>price</span> <span class=o>=</span> <span class=n>close</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=n>target_shape</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>size_type</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>SizeType</span><span class=o>.</span><span class=n>TargetPercent</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>direction</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>Direction</span><span class=o>.</span><span class=n>LongOnly</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>fees</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>fixed_fees</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>1.</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>slippage</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=mf>0.001</span><span class=p>)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>log_records</span> <span class=o>=</span> <span class=n>simulate_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>cash_sharing</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>segment_mask</span><span class=o>=</span><span class=n>segment_mask</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>pre_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>post_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_group_func_nb</span><span class=o>=</span><span class=n>pre_group_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_group_func_nb</span><span class=o>=</span><span class=n>post_group_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>pre_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>post_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_func_nb</span><span class=o>=</span><span class=n>order_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>,</span> <span class=n>slippage</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>post_order_func_nb</span>
<span class=gp>... </span><span class=p>)</span>
<span class=go>before simulation</span>
<span class=go>    before group 0</span>
<span class=go>        before segment 0</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 0</span>
<span class=go>        before segment 2</span>
<span class=go>            creating order 0 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 2</span>
<span class=go>        before segment 4</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 4</span>
<span class=go>    after group 0</span>
<span class=go>after simulation</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=o>.</span><span class=n>from_records</span><span class=p>(</span><span class=n>order_records</span><span class=p>)</span>
<span class=go>   id  col  idx       size     price      fees  side</span>
<span class=go>0   0    0    0   7.626262  4.375232  1.033367     0</span>
<span class=go>1   1    1    0   3.488053  9.565985  1.033367     0</span>
<span class=go>2   2    2    0   3.972040  7.595533  1.030170     0</span>
<span class=go>3   3    1    2   0.920352  8.786790  1.008087     1</span>
<span class=go>4   4    2    2   0.448747  6.403625  1.002874     1</span>
<span class=go>5   5    0    2   5.210115  1.524275  1.007942     0</span>
<span class=go>6   6    0    4   7.899568  8.483492  1.067016     1</span>
<span class=go>7   7    2    4  12.378281  2.639061  1.032667     0</span>
<span class=go>8   8    1    4  10.713236  2.913963  1.031218     0</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span>
<span class=go>array([[0, 1, 2],</span>
<span class=go>       [0, 1, 2],</span>
<span class=go>       [1, 2, 0],</span>
<span class=go>       [0, 1, 2],</span>
<span class=go>       [0, 2, 1]])</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>col_map</span> <span class=o>=</span> <span class=n>col_map_nb</span><span class=p>(</span><span class=n>order_records</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>],</span> <span class=n>target_shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_flow</span> <span class=o>=</span> <span class=n>asset_flow_nb</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>order_records</span><span class=p>,</span> <span class=n>col_map</span><span class=p>,</span> <span class=n>Direction</span><span class=o>.</span><span class=n>Both</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assets</span> <span class=o>=</span> <span class=n>assets_nb</span><span class=p>(</span><span class=n>asset_flow</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>asset_value</span> <span class=o>=</span> <span class=n>asset_value_nb</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>assets</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>Scatter</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>asset_value</span><span class=p>)</span><span class=o>.</span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div> <p><img alt src=/assets/images/simulate_nb.svg></p> <p>Note that the last order in a group with cash sharing is always disadvantaged as it has a bit less funds than the previous orders due to costs, which are not included when valuating the group.</p> <hr> <h2 id=vectorbt.portfolio.nb.simulate_row_wise_nb>simulate_row_wise_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L3294-L3917 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.simulate_row_wise_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>simulate_row_wise_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>init_cash</span><span class=p>,</span>
    <span class=n>cash_sharing</span><span class=p>,</span>
    <span class=n>call_seq</span><span class=p>,</span>
    <span class=n>segment_mask</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=kc>True</span><span class=p>),</span>
    <span class=n>call_pre_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>call_post_segment</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_sim_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_row_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_row_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_row_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_row_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>no_pre_func_nb</span><span class=p>,</span>
    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_segment_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>order_func_nb</span><span class=o>=</span><span class=n>no_order_func_nb</span><span class=p>,</span>
    <span class=n>order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>no_post_func_nb</span><span class=p>,</span>
    <span class=n>post_order_args</span><span class=o>=</span><span class=p>(),</span>
    <span class=n>close</span><span class=o>=</span><span class=n>array</span><span class=p>(</span><span class=n>nan</span><span class=p>),</span>
    <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>update_value</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>fill_pos_record</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>max_orders</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>max_logs</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
    <span class=n>flex_2d</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Same as <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a>, but iterates in row-major order.</p> <p>Row-major order means processing the entire row with all groups/columns before moving to the next one.</p> <p>The main difference is that instead of <code>pre_group_func_nb</code> it now exposes <code>pre_row_func_nb</code>, which is executed per entire row. It should accept <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.RowContext title=vectorbt.portfolio.enums.RowContext>RowContext</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Function <code>pre_row_func_nb</code> is only called if there is at least on active segment in the row. Functions <code>pre_segment_func_nb</code> and <code>order_func_nb</code> are only called if their segment is active. If the main task of <code>pre_row_func_nb</code> is to activate/deactivate segments, all segments should be activated by default to allow <code>pre_row_func_nb</code> to be called.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>You can only safely access data points that are to the left of the current group and rows that are to the top of the current row.</p> </div> <p><strong>Call hierarchy</strong></p> <p>Let's illustrate the same example as in <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a> but adapted for this function:</p> <p><img alt src=/assets/images/simulate_row_wise_nb.gif></p> <p><strong>Usage</strong></p> <ul> <li>Running the same example as in <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.simulate_nb title=vectorbt.portfolio.nb.simulate_nb>simulate_nb()</a> but adapted for this function:</li> </ul> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>pre_row_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>before row&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=c1># Forward down the stack</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>order_value_out</span><span class=p>,)</span>

<span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
<span class=gp>... </span><span class=k>def</span> <span class=nf>post_row_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>order_value_out</span><span class=p>):</span>
<span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\t</span><span class=s1>after row&#39;</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>)</span>
<span class=gp>... </span>    <span class=k>return</span> <span class=kc>None</span>

<span class=gp>&gt;&gt;&gt; </span><span class=n>call_seq</span> <span class=o>=</span> <span class=n>build_call_seq</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>group_lens</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>order_records</span><span class=p>,</span> <span class=n>log_records</span> <span class=o>=</span> <span class=n>simulate_row_wise_nb</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>target_shape</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>group_lens</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>init_cash</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>cash_sharing</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>call_seq</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>segment_mask</span><span class=o>=</span><span class=n>segment_mask</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_sim_func_nb</span><span class=o>=</span><span class=n>pre_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_sim_func_nb</span><span class=o>=</span><span class=n>post_sim_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_row_func_nb</span><span class=o>=</span><span class=n>pre_row_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>post_row_func_nb</span><span class=o>=</span><span class=n>post_row_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_func_nb</span><span class=o>=</span><span class=n>pre_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>pre_segment_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>post_segment_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_func_nb</span><span class=o>=</span><span class=n>order_func_nb</span><span class=p>,</span>
<span class=gp>... </span>    <span class=n>order_args</span><span class=o>=</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>size_type</span><span class=p>,</span> <span class=n>direction</span><span class=p>,</span> <span class=n>fees</span><span class=p>,</span> <span class=n>fixed_fees</span><span class=p>,</span> <span class=n>slippage</span><span class=p>),</span>
<span class=gp>... </span>    <span class=n>post_order_func_nb</span><span class=o>=</span><span class=n>post_order_func_nb</span>
<span class=gp>... </span><span class=p>)</span>
<span class=go>before simulation</span>
<span class=go>    before row 0</span>
<span class=go>        before segment 0</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 0</span>
<span class=go>    after row 0</span>
<span class=go>    before row 1</span>
<span class=go>    after row 1</span>
<span class=go>    before row 2</span>
<span class=go>        before segment 2</span>
<span class=go>            creating order 0 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 2</span>
<span class=go>    after row 2</span>
<span class=go>    before row 3</span>
<span class=go>    after row 3</span>
<span class=go>    before row 4</span>
<span class=go>        before segment 4</span>
<span class=go>            creating order 0 at column 0</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 1 at column 2</span>
<span class=go>                order status: 0</span>
<span class=go>            creating order 2 at column 1</span>
<span class=go>                order status: 0</span>
<span class=go>        after segment 4</span>
<span class=go>    after row 4</span>
<span class=go>after simulation</span>
</code></pre></div> <hr> <h2 id=vectorbt.portfolio.nb.sort_call_seq_nb>sort_call_seq_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1090-L1113 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.sort_call_seq_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>sort_call_seq_nb</span><span class=p>(</span>
    <span class=n>ctx</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>size_type</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>order_value_out</span><span class=p>,</span>
    <span class=n>ctx_select</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Sort call sequence attached to <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext title=vectorbt.portfolio.enums.SegmentContext>SegmentContext</a>.</p> <p>See <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.sort_call_seq_out_nb title=vectorbt.portfolio.nb.sort_call_seq_out_nb>sort_call_seq_out_nb()</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Can only be used in non-flexible simulation functions.</p> </div> <hr> <h2 id=vectorbt.portfolio.nb.sort_call_seq_out_nb>sort_call_seq_out_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1020-L1087 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.sort_call_seq_out_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>sort_call_seq_out_nb</span><span class=p>(</span>
    <span class=n>ctx</span><span class=p>,</span>
    <span class=n>size</span><span class=p>,</span>
    <span class=n>size_type</span><span class=p>,</span>
    <span class=n>direction</span><span class=p>,</span>
    <span class=n>order_value_out</span><span class=p>,</span>
    <span class=n>call_seq_out</span><span class=p>,</span>
    <span class=n>ctx_select</span><span class=o>=</span><span class=kc>True</span>
<span class=p>)</span>
</code></pre></div> <p>Sort call sequence <code>call_seq_out</code> based on the value of each potential order.</p> <p>Accepts <a href=/api/portfolio/enums/#vectorbt.portfolio.enums.SegmentContext title=vectorbt.portfolio.enums.SegmentContext>SegmentContext</a> and other arguments, sorts <code>call_seq_out</code> in place, and returns nothing.</p> <p>Arrays <code>size</code>, <code>size_type</code>, and <code>direction</code> utilize flexible indexing. If <code>ctx_select</code> is True, selects the elements of each <code>size</code>, <code>size_type</code>, and <code>direction</code> using <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.get_col_elem_nb title=vectorbt.portfolio.nb.get_col_elem_nb>get_col_elem_nb()</a> assuming that each array can broadcast to <code>target_shape</code>. Otherwise, selects using <a href=/api/base/reshape_fns/#vectorbt.base.reshape_fns.flex_select_auto_nb title=vectorbt.base.reshape_fns.flex_select_auto_nb>flex_select_auto_nb()</a> assuming that each array can broadcast to <code>group_len</code>.</p> <p>The lengths of <code>order_value_out</code> and <code>call_seq_out</code> should match the number of columns in the group. Array <code>order_value_out</code> should be empty and will contain sorted order values after execution. Array <code>call_seq_out</code> should be filled with integers ranging from 0 to the number of columns in the group (in this exact order).</p> <p>Best called once from <code>pre_segment_func_nb</code>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Cash sharing must be enabled and <code>call_seq_out</code> should follow <code>CallSeqType.Default</code>.</p> <p>Should be used in flexible simulation functions.</p> </div> <hr> <h2 id=vectorbt.portfolio.nb.sum_grouped_nb>sum_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6140-L6151 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.sum_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>sum_grouped_nb</span><span class=p>(</span>
    <span class=n>a</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Squeeze each group of columns into a single column using sum operation.</p> <hr> <h2 id=vectorbt.portfolio.nb.total_benchmark_return_nb>total_benchmark_return_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6439-L6445 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.total_benchmark_return_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>total_benchmark_return_nb</span><span class=p>(</span>
    <span class=n>benchmark_value</span>
<span class=p>)</span>
</code></pre></div> <p>Get total market return per column/group.</p> <hr> <h2 id=vectorbt.portfolio.nb.total_profit_grouped_nb>total_profit_grouped_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6354-L6365 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.total_profit_grouped_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>total_profit_grouped_nb</span><span class=p>(</span>
    <span class=n>total_profit</span><span class=p>,</span>
    <span class=n>group_lens</span>
<span class=p>)</span>
</code></pre></div> <p>Get total profit per group.</p> <hr> <h2 id=vectorbt.portfolio.nb.total_profit_nb>total_profit_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6304-L6351 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.total_profit_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>total_profit_nb</span><span class=p>(</span>
    <span class=n>target_shape</span><span class=p>,</span>
    <span class=n>close</span><span class=p>,</span>
    <span class=n>order_records</span><span class=p>,</span>
    <span class=n>col_map</span>
<span class=p>)</span>
</code></pre></div> <p>Get total profit per column.</p> <p>A much faster version than the one based on <a href=/api/portfolio/nb/#vectorbt.portfolio.nb.value_nb title=vectorbt.portfolio.nb.value_nb>value_nb()</a>.</p> <hr> <h2 id=vectorbt.portfolio.nb.total_return_nb>total_return_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6374-L6377 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.total_return_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>total_return_nb</span><span class=p>(</span>
    <span class=n>total_profit</span><span class=p>,</span>
    <span class=n>init_cash</span>
<span class=p>)</span>
</code></pre></div> <p>Get total return per column/group.</p> <hr> <h2 id=vectorbt.portfolio.nb.trade_losing_streak_nb>trade_losing_streak_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5781-L5792 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.trade_losing_streak_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>trade_losing_streak_nb</span><span class=p>(</span>
    <span class=n>records</span>
<span class=p>)</span>
</code></pre></div> <p>Return the current losing streak of each trade.</p> <hr> <h2 id=vectorbt.portfolio.nb.trade_winning_streak_nb>trade_winning_streak_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L5767-L5778 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.trade_winning_streak_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>trade_winning_streak_nb</span><span class=p>(</span>
    <span class=n>records</span>
<span class=p>)</span>
</code></pre></div> <p>Return the current winning streak of each trade.</p> <hr> <h2 id=vectorbt.portfolio.nb.try_order_nb>try_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1143-L1163 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.try_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>try_order_nb</span><span class=p>(</span>
    <span class=n>ctx</span><span class=p>,</span>
    <span class=n>order</span>
<span class=p>)</span>
</code></pre></div> <p>Execute an order without persistence.</p> <hr> <h2 id=vectorbt.portfolio.nb.update_open_pos_stats_nb>update_open_pos_stats_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1182-L1202 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.update_open_pos_stats_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>update_open_pos_stats_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>price</span>
<span class=p>)</span>
</code></pre></div> <p>Update statistics of an open position record using custom price.</p> <hr> <h2 id=vectorbt.portfolio.nb.update_pos_record_nb>update_pos_record_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L1205-L1298 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.update_pos_record_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>update_pos_record_nb</span><span class=p>(</span>
    <span class=n>record</span><span class=p>,</span>
    <span class=n>i</span><span class=p>,</span>
    <span class=n>col</span><span class=p>,</span>
    <span class=n>position_before</span><span class=p>,</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>order_result</span>
<span class=p>)</span>
</code></pre></div> <p>Update position record after filling an order.</p> <hr> <h2 id=vectorbt.portfolio.nb.update_value_nb>update_value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L653-L674 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.update_value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>update_value_nb</span><span class=p>(</span>
    <span class=n>cash_before</span><span class=p>,</span>
    <span class=n>cash_now</span><span class=p>,</span>
    <span class=n>position_before</span><span class=p>,</span>
    <span class=n>position_now</span><span class=p>,</span>
    <span class=n>val_price_before</span><span class=p>,</span>
    <span class=n>price</span><span class=p>,</span>
    <span class=n>value_before</span>
<span class=p>)</span>
</code></pre></div> <p>Update valuation price and value.</p> <hr> <h2 id=vectorbt.portfolio.nb.value_in_sim_order_nb>value_in_sim_order_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6259-L6295 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.value_in_sim_order_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>value_in_sim_order_nb</span><span class=p>(</span>
    <span class=n>cash</span><span class=p>,</span>
    <span class=n>asset_value</span><span class=p>,</span>
    <span class=n>group_lens</span><span class=p>,</span>
    <span class=n>call_seq</span>
<span class=p>)</span>
</code></pre></div> <p>Get portfolio value series in simulation order.</p> <hr> <h2 id=vectorbt.portfolio.nb.value_nb>value_nb <span class=dobjtype>function</span><a class=githublink href=https://github.com/polakowo/vectorbt/blob/4306accbbfb97ca19df21988296b4bf04aa12087/vectorbt/portfolio/nb.py#L6298-L6301 target=_blank title="Jump to source"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg></span></a><a class=headerlink href=#vectorbt.portfolio.nb.value_nb title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><span class=n>value_nb</span><span class=p>(</span>
    <span class=n>cash</span><span class=p>,</span>
    <span class=n>asset_value</span>
<span class=p>)</span>
</code></pre></div> <p>Get portfolio value series per column/group.</p> <footer class=sponsorship> <hr> <a href=https://github.com/sponsors/polakowo title="Become a sponsor"> <span class="twemoji heart-throb-hover"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M7.655 14.916v-.001h-.002l-.006-.003-.018-.01a22.066 22.066 0 0 1-3.744-2.584C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.044 5.231-3.886 6.818a22.094 22.094 0 0 1-3.433 2.414 7.152 7.152 0 0 1-.31.17l-.018.01-.008.004a.75.75 0 0 1-.69 0Z"/></svg> </span> </a> <hr> </footer> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021 Oleg Polakow. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> <div class=md-social> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tracking", "navigation.indexes", "navigation.tabs", "navigation.instant", "search.suggest", "search.share"], "search": "../../../assets/javascripts/workers/search.f2da59ea.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.65061dd4.min.js></script> <script src=../../../assets/javascripts/extra.js></script> </body> </html>